<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualizador de Braço de Guitarra</title>
    <style>
        /* Reset e estilos gerais */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
            color: #333;
        }
        
        h1 {
            text-align: center;
            color: #333;
            font-size: 24px;
            margin: 20px 0;
        }
        
        .subtitle {
            text-align: center;
            color: #666;
            font-size: 16px;
            margin-bottom: 20px;
        }
        
        /* Container principal com sombra */
        .main-container {
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 30px;
        }
        
        /* Estilos dos controles */
        .controls {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
            padding: 15px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
            min-width: 150px;
        }
        
        label {
            margin-bottom: 5px;
            font-weight: bold;
            font-size: 14px;
        }
        
        select, button {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            width: 100%;
        }
        
        button {
            background-color: #4285f4;
            color: white;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #3367d6;
        }
        
        .toggle-group {
            display: flex;
            gap: 5px;
            margin-top: 5px;
        }
        
        .toggle-btn {
            flex: 1;
            padding: 5px;
            font-size: 12px;
            background-color: #e0e0e0;
            color: #333;
        }
        
        .toggle-btn.active {
            background-color: #4285f4;
            color: white;
        }
        
        /* Estilos do braço da guitarra */
        .fretboard-container {
            overflow-x: auto;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .fretboard {
            display: table;
            border-collapse: collapse;
            width: 100%;
        }
        
        .string {
            display: table-row;
            height: 50px;
        }
        
        .fret {
            display: table-cell;
            width: 60px;
            border-right: 2px solid #bbb;
            position: relative;
            text-align: center;
            vertical-align: middle;
        }
        
        /* Estilo para destacar o traste 0 (cordas soltas) */
        .fret[data-fret="0"] {
            background-color: #e8e8e8;
            border-right: 2px solid #999;
        }
        
        .string:not(:last-child) .fret {
            border-bottom: 1px solid #ddd;
        }
        
        .fret-number {
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 12px;
            color: #666;
        }
        
        .string-name {
            width: 30px;
            display: table-cell;
            text-align: center;
            font-weight: bold;
            background-color: #ddd;
            color: #333;
            font-size: 14px;
        }
        
        .note {
            display: inline-block;
            width: 30px;
            height: 30px;
            line-height: 30px;
            border-radius: 50%;
            background-color: #f44336;
            color: white;
            font-weight: bold;
            text-align: center;
            font-size: 12px;
            cursor: pointer;
            transition: transform 0.15s, box-shadow 0.15s;
        }
        
        .note:hover {
            transform: scale(1.05);
            box-shadow: 0 0 5px rgba(0,0,0,0.2);
        }
        
        /* Nota destacada pelo usuário */
        .user-highlighted {
            background-color: #9c27b0 !important; /* Roxo - prioridade com !important */
            transform: scale(1.15);
            box-shadow: 0 0 8px rgba(156, 39, 176, 0.6);
            z-index: 10; /* Garantir que fique acima das outras */
        }
        
        .note.user-highlighted:hover {
            transform: scale(1.2);
            box-shadow: 0 0 10px rgba(156, 39, 176, 0.8);
        }
        
        /* Estilos da legenda */
        .legend {
            margin-top: 20px;
            padding: 15px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .legend h3 {
            margin-top: 0;
            font-size: 18px;
            margin-bottom: 15px;
            color: #333;
            border-bottom: 1px solid #eee;
            padding-bottom: 8px;
        }
        
        .legend-items {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 14px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            flex-shrink: 0;
        }
        
        /* Cores para as notas */
        .root {
            background-color: #f44336;
        }
        
        .scale-note {
            background-color: #4caf50;
        }
        
        .chord-note {
            background-color: #2196f3;
        }
        
        .triad-note {
            background-color: #f44336;
        }
        
        /* Blue note - destacada em azul escuro */
        .blue-note {
            background-color: #1a237e;
        }
        
        /* User highlighted note */
        .highlight-note {
            background-color: #9c27b0;
        }
        
        /* Cores para os intervalos */
        .interval-1P {
            background-color: #f44336; /* Vermelho - Fundamental */
        }
        
        .interval-2m, .interval-2M {
            background-color: #ff9800; /* Laranja - Segundas */
        }
        
        .interval-3m, .interval-3M {
            background-color: #ffeb3b; /* Amarelo - Terças */
        }
        
        .interval-4P {
            background-color: #8bc34a; /* Verde claro - Quarta */
        }
        
        .interval-Tr {
            background-color: #009688; /* Teal - Trítono */
        }
        
        .interval-5P {
            background-color: #2196f3; /* Azul - Quinta */
        }
        
        .interval-6m, .interval-6M {
            background-color: #673ab7; /* Roxo - Sextas */
        }
        
        .interval-7m, .interval-7M {
            background-color: #9c27b0; /* Rosa - Sétimas */
        }
        
        /* Cores para as tríades */
        .triad-i, .triad-major {
            background-color: #4caf50;
        }
        
        .triad-ii, .triad-minor {
            background-color: #2196f3;
        }
        
        .triad-iii, .triad-dim {
            background-color: #9c27b0;
        }
        
        .triad-iv, .triad-aug {
            background-color: #ff9800;
        }
        
        .triad-v {
            background-color: #2196f3;
        }
        
        .triad-vi {
            background-color: #9c27b0;
        }
        
        .triad-vii {
            background-color: #795548;
        }
        
        .triad-badge {
            display: inline-block;
            padding: 3px 6px;
            margin-right: 5px;
            border-radius: 4px;
            color: white;
            font-weight: bold;
            font-size: 12px;
        }
        
        .intervals-legend {
            margin-top: 15px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .interval-badge {
            padding: 3px 6px;
            border-radius: 4px;
            color: white;
            font-weight: bold;
            font-size: 12px;
        }
        
        /* Layout horizontal para as notas das tríades - clicável */
        .triad-info {
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 3px;
            flex-wrap: nowrap;
            min-width: 200px;
            cursor: pointer;
            padding: 3px 6px;
            border-radius: 3px;
            transition: background-color 0.2s;
        }
        
        .triad-info:hover {
            background-color: #e0e0e0;
        }
        
        /* Status de seleção */
        .selection-status {
            display: block;
            text-align: center;
            font-size: 14px;
            color: #666;
            margin-top: 5px;
            margin-bottom: 10px;
            font-style: italic;
        }
        
        /* Estilo para marcadores de traste (inlays) */
        .inlay-markers {
            display: flex;
            margin-bottom: 10px;
            padding-left: 40px; /* Espaço para a identificação das cordas */
        }
        
        .inlay-marker {
            width: 60px;
            height: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .inlay-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: #aaa;
        }
        
        .inlay-dot.double-dot {
            position: relative;
        }
        
        .inlay-dot.double-dot:before {
            content: '';
            position: absolute;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: #aaa;
            left: -15px;
        }
        
        .inlay-dot.double-dot:after {
            content: '';
            position: absolute;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: #aaa;
            right: -15px;
        }
        
        /* Tabs para organizar a interface */
        .tabs {
            display: flex;
            overflow: hidden;
            margin-bottom: 20px;
            border-radius: 4px;
            border: 1px solid #ddd;
        }
        
        .tab-button {
            flex: 1;
            background-color: #f1f1f1;
            border: none;
            border-right: 1px solid #ddd;
            cursor: pointer;
            padding: 10px;
            transition: 0.3s;
            font-weight: 600;
            font-size: 14px;
            color: #555;
        }
        
        .tab-button:last-child {
            border-right: none;
        }
        
        .tab-button:hover {
            background-color: #e0e0e0;
        }
        
        .tab-button.active {
            background-color: #4285f4;
            color: white;
        }
        
        /* Botões de ação secundários */
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .secondary-button {
            flex: 1;
            padding: 6px 12px;
            background-color: #f1f1f1;
            color: #333;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s;
        }
        
        .secondary-button:hover {
            background-color: #e0e0e0;
        }
        
        /* Card de informações */
        .info-card {
            margin-top: 15px;
            padding: 15px;
            background-color: #f9f9f9;
            border-left: 4px solid #4285f4;
            border-radius: 0 4px 4px 0;
        }
        
        .info-card h4 {
            margin-top: 0;
            color: #4285f4;
            font-size: 16px;
            margin-bottom: 8px;
        }
        
        .info-card p {
            margin: 0;
            font-size: 14px;
            line-height: 1.5;
            color: #555;
        }
        
        /* Estilos para o Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.4);
            animation: fadeIn 0.3s;
        }
        
        .modal-content {
            background-color: #fefefe;
            margin: 10% auto;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            max-width: 500px;
            width: 80%;
            animation: slideIn 0.3s;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .modal-body {
            padding: 15px 0;
        }
        
        .modal-footer {
            padding-top: 15px;
            border-top: 1px solid #eee;
            text-align: right;
        }
        
        .close {
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .close:hover {
            color: #333;
        }
        
        @keyframes fadeIn {
            from {opacity: 0;}
            to {opacity: 1;}
        }
        
        @keyframes slideIn {
            from {transform: translateY(-50px); opacity: 0;}
            to {transform: translateY(0); opacity: 1;}
        }
        
        /* Responsividade */
        @media (max-width: 768px) {
            .controls {
                flex-direction: column;
                align-items: center;
            }
            
            .control-group {
                width: 100%;
                max-width: 300px;
            }
            
            .fret {
                width: 50px;
            }
            
            .note {
                width: 25px;
                height: 25px;
                line-height: 25px;
                font-size: 11px;
            }
            
            .tabs {
                flex-wrap: wrap;
            }
            
            .tab-button {
                flex-basis: 33.33%;
                border-bottom: 1px solid #ddd;
            }
        }
        
        @media (max-width: 480px) {
            body {
                padding: 10px;
            }
            
            h1 {
                font-size: 20px;
            }
            
            .fret {
                width: 45px;
            }
            
            .note {
                width: 22px;
                height: 22px;
                line-height: 22px;
                font-size: 10px;
            }
            
            .tab-button {
                flex-basis: 50%;
            }
        }
        
        /* Modo escuro para suportar preferências do sistema */
        @media (prefers-color-scheme: dark) {
            body {
                background-color: #222;
                color: #f1f1f1;
            }
            
            h1 {
                color: #f1f1f1;
            }
            
            .main-container,
            .controls,
            .fretboard-container,
            .legend {
                background-color: #333;
                box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            }
            
            .subtitle {
                color: #ccc;
            }
            
            .fret {
                border-right-color: #555;
            }
            
            .string:not(:last-child) .fret {
                border-bottom-color: #444;
            }
            
            .fret[data-fret="0"] {
                background-color: #444;
                border-right-color: #555;
            }
            
            .string-name {
                background-color: #444;
                color: #f1f1f1;
            }
            
            select, button {
                background-color: #444;
                color: #f1f1f1;
                border-color: #555;
            }
            
            .toggle-btn {
                background-color: #444;
                color: #f1f1f1;
            }
            
            .secondary-button {
                background-color: #444;
                color: #f1f1f1;
                border-color: #555;
            }
            
            .secondary-button:hover {
                background-color: #555;
            }
            
            .info-card {
                background-color: #3a3a3a;
                border-left-color: #4285f4;
            }
            
            .info-box {
                background-color: #2a3542;
                border-left-color: #4285f4;
                color: #e0e0e0;
            }
            
            .info-card p {
                color: #ddd;
            }
            
            .tab-button {
                background-color: #444;
                color: #f1f1f1;
                border-color: #555;
            }
            
            .tab-button:hover {
                background-color: #555;
            }
            
            .legend h3 {
                color: #f1f1f1;
                border-bottom-color: #444;
            }
            
            label {
                color: #f1f1f1;
            }
            
            .triad-info:hover {
                background-color: #444;
            }
            
            .modal-content {
                background-color: #333;
                color: #f1f1f1;
            }
            
            .modal-header, .modal-footer {
                border-color: #444;
            }
            
            .close {
                color: #f1f1f1;
            }
            
            .close:hover {
                color: #fff;
            }
        }
    </style>
</head>
<body>
    <h1>Visualizador de Braço de Guitarra</h1>
    <p class="subtitle">Uma ferramenta interativa para aprender teoria musical aplicada à guitarra</p>
    
    <div class="main-container">
        <div class="tabs">
            <button class="tab-button active" data-mode="notes">🎵 Notas</button>
            <button class="tab-button" data-mode="scales">🎼 Escalas</button>
            <button class="tab-button" data-mode="chord">🎸 Acordes</button>
            <button class="tab-button" data-mode="scale-triads">🎶 Tríades da Escala</button>
            <button class="tab-button" data-mode="all-triads">🎹 Tipos de Tríades</button>
            <button class="tab-button" data-mode="intervals">📏 Intervalos</button>
        </div>
        
        <div class="controls">
            <div class="control-group">
                <label for="instrument-select">Instrumento:</label>
                <select id="instrument-select">
                    <option value="guitar">🎸 Guitarra</option>
                    <option value="bass">🎻 Baixo</option>
                </select>
            </div>
            
            <div class="control-group">
                <label>&nbsp;</label>
                <button id="tuning-button">🎸 Afinação</button>
            </div>
            
            <div class="control-group">
                <label for="root-note">Nota Raiz:</label>
                <select id="root-note">
                    <option value="C">C</option>
                    <option value="C#">C#</option>
                    <option value="D">D</option>
                    <option value="D#">D#</option>
                    <option value="E">E</option>
                    <option value="F">F</option>
                    <option value="F#">F#</option>
                    <option value="G">G</option>
                    <option value="G#">G#</option>
                    <option value="A">A</option>
                    <option value="A#">A#</option>
                    <option value="B">B</option>
                </select>
            </div>
            
            <div class="control-group" id="scale-type-group" style="display: none;">
                <label for="scale-type">Tipo de Escala:</label>
                <select id="scale-type">
                    <optgroup label="Escalas Básicas">
                        <option value="major">Maior</option>
                        <option value="minor">Menor</option>
                        <option value="pentatonic_major">Pentatônica Maior</option>
                        <option value="pentatonic_minor">Pentatônica Menor</option>
                        <option value="pentatonic_minor_blue">Pentatônica Menor com Blue Note</option>
                        <option value="pentatonic_major_blue">Pentatônica Maior com Blue Note</option>
                        <option value="blues">Blues</option>
                    </optgroup>
                    <optgroup label="Modos Gregos">
                        <option value="ionian">Jônio (Maior)</option>
                        <option value="dorian">Dórico</option>
                        <option value="phrygian">Frígio</option>
                        <option value="lydian">Lídio</option>
                        <option value="mixolydian">Mixolídio</option>
                        <option value="aeolian">Eólio (Menor)</option>
                        <option value="locrian">Lócrio</option>
                    </optgroup>
                </select>
            </div>
            
            <div class="control-group" id="chord-type-group" style="display: none;">
                <label for="chord-type">Tipo de Acorde:</label>
                <select id="chord-type">
                    <option value="major">Maior</option>
                    <option value="minor">Menor</option>
                    <option value="7">Dominante 7</option>
                    <option value="maj7">Maior 7</option>
                    <option value="m7">Menor 7</option>
                    <option value="dim">Diminuto</option>
                    <option value="aug">Aumentado</option>
                    <option value="m7b5">Meio-Diminuto (m7b5)</option>
                </select>
            </div>
            
            <div class="control-group">
                <label for="display-toggle">Exibir:</label>
                <div class="toggle-group" id="display-toggle">
                    <button class="toggle-btn active" data-show="notes">🎵 Notas</button>
                    <button class="toggle-btn" data-show="intervals">📏 Intervalos</button>
                </div>
            </div>
            
            <div class="control-group">
                <label>&nbsp;</label>
                <button id="clear-highlighted">🧹 Limpar Seleção</button>
            </div>
        </div>
        
        <div class="selection-status" id="selection-status">Clique em qualquer nota para destacá-la. Notas destacadas: 0</div>
        
        <div class="inlay-markers" id="inlay-markers">
            <!-- Marcadores de inlay serão gerados pelo JavaScript -->
        </div>
        
        <div class="fretboard-container">
            <div class="fretboard" id="fretboard">
                <!-- O braço da guitarra será gerado com JavaScript -->
            </div>
        </div>
        
        <div id="triads-info" class="legend" style="display: none; margin-top: 20px; margin-bottom: 20px;">
            <h3>Tríades da Escala</h3>
            <div id="triads-list" class="legend-items">
                <!-- Lista de tríades será gerada dinamicamente -->
            </div>
        </div>
        
        <div id="all-triads-info" class="legend" style="display: none; margin-top: 20px; margin-bottom: 20px;">
            <h3>Tipos de Tríades</h3>
            <div id="all-triads-list" class="legend-items">
                <!-- Lista de todos os tipos de tríades será gerada dinamicamente -->
            </div>
        </div>
        
        <div class="info-card" id="info-card">
            <h4>Visualizador de Braço de Guitarra</h4>
            <p>Selecione um modo de visualização nas abas acima para começar a explorar o braço da guitarra. Clique em qualquer nota para destacá-la.</p>
        </div>
    </div>
    
    <div class="legend">
        <h3>Legenda</h3>
        <div class="legend-items">
            <div class="legend-item">
                <div class="legend-color root"></div>
                <span>Nota Raiz</span>
            </div>
            <div class="legend-item">
                <div class="legend-color scale-note"></div>
                <span>Nota da Escala</span>
            </div>
            <div class="legend-item">
                <div class="legend-color blue-note"></div>
                <span>Blue Note (b5)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color chord-note"></div>
                <span>Nota do Acorde</span>
            </div>
            <div class="legend-item">
                <div class="legend-color triad-note"></div>
                <span>Nota da Tríade</span>
            </div>
            <div class="legend-item">
                <div class="legend-color highlight-note"></div>
                <span>Nota Destacada</span>
            </div>
            <div class="legend-item" style="background-color: #e8e8e8; padding: 5px; border-radius: 4px;">
                <span>Cordas Soltas (Traste 0)</span>
            </div>
        </div>
        
        <div id="intervals-legend" class="intervals-legend" style="display: none;">
            <h4>Intervalos:</h4>
            <div class="interval-badge interval-1P">1P</div>
            <div class="interval-badge interval-2m">2m</div>
            <div class="interval-badge interval-2M">2M</div>
            <div class="interval-badge interval-3m">3m</div>
            <div class="interval-badge interval-3M">3M</div>
            <div class="interval-badge interval-4P">4P</div>
            <div class="interval-badge interval-Tr">Tr</div>
            <div class="interval-badge interval-5P">5P</div>
            <div class="interval-badge interval-6m">6m</div>
            <div class="interval-badge interval-6M">6M</div>
            <div class="interval-badge interval-7m">7m</div>
            <div class="interval-badge interval-7M">7M</div>
        </div>
    </div>
    
    <!-- Modal de Afinação -->
    <div id="tuning-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Selecionar Afinação</h3>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <div class="control-group">
                    <label for="tuning-select">Afinação:</label>
                    <select id="tuning-select">
                        <option value="standard">Padrão (E A D G B E)</option>
                        <option value="drop-d">Drop D (D A D G B E)</option>
                        <option value="drop-c">Drop C (C G C F A D)</option>
                        <option value="open-g">Open G (D G D G B D)</option>
                        <option value="open-d">Open D (D A D F# A D)</option>
                        <option value="dadgad">DADGAD (D A D G A D)</option>
                        <option value="open-e">Open E (E B E G# B E)</option>
                        <option value="custom">Personalizada</option>
                    </select>
                </div>
                
                <div id="custom-tuning-group" style="display: none; margin-top: 15px;">
                    <label>Afinação Personalizada:</label>
                    <div id="custom-tuning-container" style="display: flex; flex-wrap: wrap; gap: 5px; margin-top: 8px;">
                        <!-- Selects de afinação personalizada para guitarra (6 cordas) -->
                        <div style="display: block;">
                            <select class="custom-tuning" data-string="6">
                                <option value="C">C</option>
                                <option value="C#">C#</option>
                                <option value="D">D</option>
                                <option value="D#">D#</option>
                                <option value="E" selected>E</option>
                                <option value="F">F</option>
                                <option value="F#">F#</option>
                                <option value="G">G</option>
                                <option value="G#">G#</option>
                                <option value="A">A</option>
                                <option value="A#">A#</option>
                                <option value="B">B</option>
                            </select>
                        </div>
                        <div style="display: block;">
                            <select class="custom-tuning" data-string="5">
                                <option value="C">C</option>
                                <option value="C#">C#</option>
                                <option value="D">D</option>
                                <option value="D#">D#</option>
                                <option value="E">E</option>
                                <option value="F">F</option>
                                <option value="F#">F#</option>
                                <option value="G">G</option>
                                <option value="G#">G#</option>
                                <option value="A" selected>A</option>
                                <option value="A#">A#</option>
                                <option value="B">B</option>
                            </select>
                        </div>
                        <div style="display: block;">
                            <select class="custom-tuning" data-string="4">
                                <option value="C">C</option>
                                <option value="C#">C#</option>
                                <option value="D" selected>D</option>
                                <option value="D#">D#</option>
                                <option value="E">E</option>
                                <option value="F">F</option>
                                <option value="F#">F#</option>
                                <option value="G">G</option>
                                <option value="G#">G#</option>
                                <option value="A">A</option>
                                <option value="A#">A#</option>
                                <option value="B">B</option>
                            </select>
                        </div>
                        <div style="display: block;">
                            <select class="custom-tuning" data-string="3">
                                <option value="C">C</option>
                                <option value="C#">C#</option>
                                <option value="D">D</option>
                                <option value="D#">D#</option>
                                <option value="E">E</option>
                                <option value="F">F</option>
                                <option value="F#">F#</option>
                                <option value="G" selected>G</option>
                                <option value="G#">G#</option>
                                <option value="A">A</option>
                                <option value="A#">A#</option>
                                <option value="B">B</option>
                            </select>
                        </div>
                        <div style="display: block;">
                            <select class="custom-tuning" data-string="2">
                                <option value="C">C</option>
                                <option value="C#">C#</option>
                                <option value="D">D</option>
                                <option value="D#">D#</option>
                                <option value="E">E</option>
                                <option value="F">F</option>
                                <option value="F#">F#</option>
                                <option value="G">G</option>
                                <option value="G#">G#</option>
                                <option value="A">A</option>
                                <option value="A#">A#</option>
                                <option value="B" selected>B</option>
                            </select>
                        </div>
                        <div style="display: block;">
                            <select class="custom-tuning" data-string="1">
                                <option value="C">C</option>
                                <option value="C#">C#</option>
                                <option value="D">D</option>
                                <option value="D#">D#</option>
                                <option value="E" selected>E</option>
                                <option value="F">F</option>
                                <option value="F#">F#</option>
                                <option value="G">G</option>
                                <option value="G#">G#</option>
                                <option value="A">A</option>
                                <option value="A#">A#</option>
                                <option value="B">B</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="apply-tuning" class="secondary-button">✅ Aplicar</button>
                <button id="cancel-tuning" class="secondary-button">❌ Cancelar</button>
            </div>
        </div>
    </div>
    
    <footer style="text-align: center; margin-top: 30px; padding: 15px; color: #666; font-size: 14px; border-top: 1px solid #ddd;">
        © 2025 Direitos Autorais - Fabio Alberti (fabiocax@gmail.com)
    </footer>
    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-RTGSCCHX86"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-RTGSCCHX86');
</script>
    <script>
                    document.addEventListener('DOMContentLoaded', function() {
            // Definições globais
            const NOTES = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];
            
            // Instrumento atual (guitarra por padrão)
            let currentInstrument = 'guitar';
            
            // Afinações de guitarra (da corda mais aguda para a mais grave)
            const GUITAR_TUNINGS = {
                'standard': ['E', 'B', 'G', 'D', 'A', 'E'],
                'drop-d': ['E', 'B', 'G', 'D', 'A', 'D'],
                'drop-c': ['D', 'A', 'F', 'C', 'G', 'C'],
                'open-g': ['D', 'B', 'G', 'D', 'G', 'D'],
                'open-d': ['D', 'A', 'F#', 'D', 'A', 'D'],
                'dadgad': ['D', 'A', 'G', 'D', 'A', 'D'],
                'open-e': ['E', 'B', 'G#', 'E', 'B', 'E'],
                'custom': ['E', 'B', 'G', 'D', 'A', 'E']
            };
            
            // Afinações de baixo (da corda mais aguda para a mais grave)
            const BASS_TUNINGS = {
                'standard': ['G', 'D', 'A', 'E'],
                'drop-d': ['G', 'D', 'A', 'D'],
                'five-string': ['G', 'D', 'A', 'E', 'B'],
                'six-string': ['C', 'G', 'D', 'A', 'E', 'B'],
                'custom': ['G', 'D', 'A', 'E']
            };
            
            // Afinação inicial da guitarra - padrão
            let currentTuning = [...GUITAR_TUNINGS.standard];
            
            // Objeto de referência para as afinações do instrumento atual
            let TUNINGS = GUITAR_TUNINGS;
            
            const NUM_FRETS = 12; // Número de trastes a mostrar
            
            // Definição de intervalos
            const INTERVAL_NAMES = {
                0: '1P', 1: '2m', 2: '2M', 3: '3m', 4: '3M', 5: '4P', 
                6: 'Tr', 7: '5P', 8: '6m', 9: '6M', 10: '7m', 11: '7M'
            };
            
            // Definição de escalas (intervalos em relação à raiz)
            const SCALES = {
                'major': [0, 2, 4, 5, 7, 9, 11],
                'minor': [0, 2, 3, 5, 7, 8, 10],
                'pentatonic_major': [0, 2, 4, 7, 9],
                'pentatonic_minor': [0, 3, 5, 7, 10],
                'pentatonic_minor_blue': [0, 3, 5, 6, 7, 10],
                'pentatonic_major_blue': [0, 2, 4, 6, 7, 9],
                'blues': [0, 3, 5, 6, 7, 10],
                'ionian': [0, 2, 4, 5, 7, 9, 11],
                'dorian': [0, 2, 3, 5, 7, 9, 10],
                'phrygian': [0, 1, 3, 5, 7, 8, 10],
                'lydian': [0, 2, 4, 6, 7, 9, 11],
                'mixolydian': [0, 2, 4, 5, 7, 9, 10],
                'aeolian': [0, 2, 3, 5, 7, 8, 10],
                'locrian': [0, 1, 3, 5, 6, 8, 10]
            };
            
            // Definição de acordes (intervalos em relação à raiz)
            const CHORDS = {
                'major': [0, 4, 7],
                'minor': [0, 3, 7],
                'dim': [0, 3, 6],
                'aug': [0, 4, 8],
                '7': [0, 4, 7, 10],
                'maj7': [0, 4, 7, 11],
                'm7': [0, 3, 7, 10],
                'm7b5': [0, 3, 6, 10]
            };
            
            // Elementos DOM
            const fretboardEl = document.getElementById('fretboard');
            const inlayMarkersEl = document.getElementById('inlay-markers');
            const tabButtonsEl = document.querySelectorAll('.tab-button');
            const rootNoteEl = document.getElementById('root-note');
            const scaleTypeEl = document.getElementById('scale-type');
            const chordTypeEl = document.getElementById('chord-type');
            const scaleTypeGroupEl = document.getElementById('scale-type-group');
            const chordTypeGroupEl = document.getElementById('chord-type-group');
            const clearHighlightedEl = document.getElementById('clear-highlighted');
            const displayToggleEl = document.getElementById('display-toggle');
            const intervalsLegendEl = document.getElementById('intervals-legend');
            const triadsInfoEl = document.getElementById('triads-info');
            const allTriadsInfoEl = document.getElementById('all-triads-info');
            const selectionStatusEl = document.getElementById('selection-status');
            const infoCardEl = document.getElementById('info-card');
            
            // Elementos do Modal de Afinação
            const tuningButtonEl = document.getElementById('tuning-button');
            const tuningModalEl = document.getElementById('tuning-modal');
            const tuningSelectEl = document.getElementById('tuning-select');
            const customTuningGroupEl = document.getElementById('custom-tuning-group');
            const customTuningEls = document.querySelectorAll('.custom-tuning');
            const applyTuningEl = document.getElementById('apply-tuning');
            const cancelTuningEl = document.getElementById('cancel-tuning');
            const closeModalEl = document.querySelector('.close');
            
            // Elemento seletor de instrumento
            const instrumentSelectEl = document.getElementById('instrument-select');
            
            // Estado da aplicação
            let fretboardData = [];
            let fretboardIntervalsData = [];
            let scaleData = { notes: [], intervals: [] };
            let chordData = { notes: [], intervals: [] };
            let scaleTriads = [];
            let allTriads = {};
            let currentTriadIndex = 0;
            let currentTriadType = '';
            let showNotation = 'notes';
            let currentMode = 'notes';
            
            // Armazenar temporariamente as mudanças de afinação antes de aplicar
            let tempTuning = [...currentTuning];
            
            // Notas que o usuário destacou manualmente
            let userHighlightedNotes = new Set();
            
            // Inicialização principal
            initFretboard();
            initInlayMarkers();
            setupEventListeners();
            updateControlsVisibility();
            updateTuningOptions();
            generateFretboardData();
            updateFretboard();
            updateInfoCard();
            
            // Configura todos os event listeners
            function setupEventListeners() {
                // Event listeners para os botões de tab
                tabButtonsEl.forEach(btn => {
                    btn.addEventListener('click', function() {
                        currentMode = this.dataset.mode;
                        
                        // Atualizar botões ativos
                        tabButtonsEl.forEach(b => b.classList.remove('active'));
                        this.classList.add('active');
                        
                        // Atualizar visibilidade dos controles
                        updateControlsVisibility();
                        
                        // Atualizar o braço
                        updateFretboard();
                        
                        // Atualizar o card de informações
                        updateInfoCard();
                    });
                });
                
                // Botão para limpar seleção
                clearHighlightedEl.addEventListener('click', clearHighlightedNotes);
                
                // Botões toggle para exibição (notas/intervalos)
                const toggleBtns = displayToggleEl.querySelectorAll('.toggle-btn');
                toggleBtns.forEach(btn => {
                    btn.addEventListener('click', function() {
                        toggleBtns.forEach(b => b.classList.remove('active'));
                        this.classList.add('active');
                        showNotation = this.dataset.show;
                        updateFretboard();
                    });
                });
                
                // Event listeners para alterações em selects
                rootNoteEl.addEventListener('change', updateFretboard);
                scaleTypeEl.addEventListener('change', updateFretboard);
                chordTypeEl.addEventListener('change', updateFretboard);
                
                // Event listener para alteração de instrumento
                instrumentSelectEl.addEventListener('change', function() {
                    const newInstrument = this.value;
                    
                    if (newInstrument !== currentInstrument) {
                        currentInstrument = newInstrument;
                        
                        // Atualizar as afinações disponíveis
                        if (currentInstrument === 'guitar') {
                            TUNINGS = GUITAR_TUNINGS;
                            currentTuning = [...GUITAR_TUNINGS.standard];
                            tuningButtonEl.innerHTML = '🎸 Afinação';
                        } else if (currentInstrument === 'bass') {
                            TUNINGS = BASS_TUNINGS;
                            currentTuning = [...BASS_TUNINGS.standard];
                            tuningButtonEl.innerHTML = '🎻 Afinação';
                        }
                        
                        // Reconstruir o braço com a nova afinação
                        initFretboard();
                        generateFretboardData();
                        updateFretboard();
                        updateTuningOptions();
                    }
                });
                
                // Modal de Afinação
                tuningButtonEl.addEventListener('click', openTuningModal);
                closeModalEl.addEventListener('click', closeTuningModal);
                cancelTuningEl.addEventListener('click', closeTuningModal);
                applyTuningEl.addEventListener('click', applyTuningChanges);
                
                // Evento para afinação padrão vs. personalizada
                tuningSelectEl.addEventListener('change', function() {
                    const selectedTuning = this.value;
                    
                    if (selectedTuning === 'custom') {
                        customTuningGroupEl.style.display = 'block';
                        
                        // Atualizar os selects da afinação personalizada
                        updateCustomTuningSelects();
                    } else {
                        customTuningGroupEl.style.display = 'none';
                        tempTuning = [...TUNINGS[selectedTuning]];
                    }
                });
                
                // Atualização da afinação personalizada
                customTuningEls.forEach(select => {
                    select.addEventListener('change', function() {
                        const stringIndex = parseInt(this.dataset.string) - 1;
                        const reversedIndex = (currentTuning.length - stringIndex) - 1;
                        tempTuning[reversedIndex] = this.value;
                    });
                });
                
                // Fechar o modal ao clicar fora dele
                window.addEventListener('click', function(event) {
                    if (event.target === tuningModalEl) {
                        closeTuningModal();
                    }
                });
            }
            
            // Atualiza as opções de afinação no modal com base no instrumento selecionado
            function updateTuningOptions() {
                tuningSelectEl.innerHTML = '';
                
                let tuningOptions;
                if (currentInstrument === 'guitar') {
                    tuningOptions = {
                        'standard': 'Padrão (E A D G B E)',
                        'drop-d': 'Drop D (D A D G B E)',
                        'drop-c': 'Drop C (C G C F A D)',
                        'open-g': 'Open G (D G D G B D)',
                        'open-d': 'Open D (D A D F# A D)',
                        'dadgad': 'DADGAD (D A D G A D)',
                        'open-e': 'Open E (E B E G# B E)',
                        'custom': 'Personalizada'
                    };
                } else if (currentInstrument === 'bass') {
                    tuningOptions = {
                        'standard': 'Padrão (E A D G)',
                        'drop-d': 'Drop D (D A D G)',
                        'five-string': '5 Cordas (B E A D G)',
                        'six-string': '6 Cordas (B E A D G C)',
                        'custom': 'Personalizada'
                    };
                }
                
                for (const [value, label] of Object.entries(tuningOptions)) {
                    const option = document.createElement('option');
                    option.value = value;
                    option.textContent = label;
                    tuningSelectEl.appendChild(option);
                }
            }
            
            // Atualiza os selects de afinação personalizada com base no instrumento
            function updateCustomTuningSelects() {
                // Esconder todos os selects primeiro
                customTuningEls.forEach(select => {
                    const parent = select.parentElement;
                    if (parent) {
                        parent.style.display = 'none';
                    }
                });
                
                // Mostrar apenas os necessários para o instrumento atual
                const numStrings = currentTuning.length;
                
                for (let i = 1; i <= numStrings; i++) {
                    const select = document.querySelector(`.custom-tuning[data-string="${i}"]`);
                    if (select) {
                        const parent = select.parentElement;
                        if (parent) {
                            parent.style.display = 'block';
                        }
                        const stringIndex = i - 1;
                        const reversedIndex = (numStrings - stringIndex) - 1;
                        select.value = tempTuning[reversedIndex];
                    }
                }
            }
            
            // Funções do Modal de Afinação
            function openTuningModal() {
                // Copiar a afinação atual para a temporária
                tempTuning = [...currentTuning];
                
                // Atualizar as opções de afinação com base no instrumento atual
                updateTuningOptions();
                
                // Selecionar a afinação atual no select se for uma afinação conhecida
                let matchFound = false;
                for (const [key, tuning] of Object.entries(TUNINGS)) {
                    if (arraysEqual(tuning, currentTuning)) {
                        tuningSelectEl.value = key;
                        matchFound = true;
                        break;
                    }
                }
                
                if (!matchFound) {
                    tuningSelectEl.value = 'custom';
                    customTuningGroupEl.style.display = 'block';
                    updateCustomTuningSelects();
                } else {
                    customTuningGroupEl.style.display = tuningSelectEl.value === 'custom' ? 'block' : 'none';
                    if (tuningSelectEl.value === 'custom') {
                        updateCustomTuningSelects();
                    }
                }
                
                tuningModalEl.style.display = 'block';
            }
            
            function closeTuningModal() {
                tuningModalEl.style.display = 'none';
            }
            
            function applyTuningChanges() {
                // Aplicar as mudanças da afinação temporária para a atual
                currentTuning = [...tempTuning];
                
                // Salvar em custom se for personalizada
                if (tuningSelectEl.value === 'custom') {
                    TUNINGS.custom = [...tempTuning];
                }
                
                // Reconstruir o braço com a nova afinação
                initFretboard();
                generateFretboardData();
                updateFretboard();
                
                closeTuningModal();
            }
            
            // Função auxiliar para comparar arrays
            function arraysEqual(a, b) {
                if (a.length !== b.length) return false;
                for (let i = 0; i < a.length; i++) {
                    if (a[i] !== b[i]) return false;
                }
                return true;
            }
            
            // Inicializa os marcadores de inlay (bolinhas nos trastes)
            function initInlayMarkers() {
                inlayMarkersEl.innerHTML = '';
                
                // Adicionar espaço para nomes das cordas
                const spacer = document.createElement('div');
                spacer.style.width = '30px';
                inlayMarkersEl.appendChild(spacer);
                
                // Criar marcadores para cada traste
                for (let i = 0; i <= NUM_FRETS; i++) {
                    const markerEl = document.createElement('div');
                    markerEl.className = 'inlay-marker';
                    
                    // Adicionar bolinhas nos trastes 3, 5, 7, 9
                    if ([3, 5, 7, 9].includes(i)) {
                        const dotEl = document.createElement('div');
                        dotEl.className = 'inlay-dot';
                        markerEl.appendChild(dotEl);
                    }
                    // Adicionar bolinhas duplas no traste 12
                    else if (i === 12) {
                        const dotEl = document.createElement('div');
                        dotEl.className = 'inlay-dot double-dot';
                        markerEl.appendChild(dotEl);
                    }
                    
                    inlayMarkersEl.appendChild(markerEl);
                }
            }
            
            // Cria o braço da guitarra no DOM
            function initFretboard() {
                fretboardEl.innerHTML = '';
                
                for (let i = 0; i < currentTuning.length; i++) {
                    const stringEl = document.createElement('div');
                    stringEl.className = 'string';
                    
                    const stringNameEl = document.createElement('div');
                    stringNameEl.className = 'string-name';
                    stringNameEl.textContent = currentTuning[i];
                    stringEl.appendChild(stringNameEl);
                    
                    for (let j = 0; j <= NUM_FRETS; j++) {
                        const fretEl = document.createElement('div');
                        fretEl.className = 'fret';
                        fretEl.dataset.string = i + 1;
                        fretEl.dataset.fret = j;
                        
                        if (i === 0) {
                            const fretNumberEl = document.createElement('div');
                            fretNumberEl.className = 'fret-number';
                            fretNumberEl.textContent = j;
                            fretEl.appendChild(fretNumberEl);
                        }
                        
                        stringEl.appendChild(fretEl);
                    }
                    
                    fretboardEl.appendChild(stringEl);
                }
            }
            
            // Atualizar o card de informações
            function updateInfoCard() {
                const titleEl = document.createElement('h4');
                const contentEl = document.createElement('p');
                
                switch (currentMode) {
                    case 'notes':
                        titleEl.textContent = 'Todas as Notas';
                        contentEl.textContent = 'Visualizando todas as notas no braço da guitarra. Clique em qualquer nota para destacá-la.';
                        break;
                    case 'intervals':
                        titleEl.textContent = 'Intervalos';
                        contentEl.textContent = 'Visualizando os intervalos em relação à nota raiz selecionada. Os intervalos são codificados por cores.';
                        break;
                    case 'scales':
                        titleEl.textContent = `Escala ${getScaleTypeName(scaleTypeEl.value)} de ${rootNoteEl.value}`;
                        contentEl.textContent = `Visualizando as notas da escala. As notas em vermelho são a nota raiz, as verdes são notas da escala, e as azuis escuras são blue notes (quando aplicável).`;
                        break;
                    case 'chord':
                        titleEl.textContent = `Acorde ${getChordName(rootNoteEl.value, chordTypeEl.value)}`;
                        contentEl.textContent = `Visualizando as notas do acorde. A nota raiz está em vermelho e as demais notas do acorde em azul.`;
                        break;
                    case 'scale-triads':
                        titleEl.textContent = 'Tríades da Escala';
                        contentEl.textContent = `Visualizando as tríades formadas em cada grau da escala ${getScaleTypeName(scaleTypeEl.value)} de ${rootNoteEl.value}. Clique em uma tríade abaixo para vê-la no braço.`;
                        break;
                    case 'all-triads':
                        titleEl.textContent = 'Tipos de Tríades';
                        contentEl.textContent = `Visualizando os diferentes tipos de tríades para a nota raiz ${rootNoteEl.value}. Clique em um tipo de tríade abaixo para vê-la no braço.`;
                        break;
                }
                
                infoCardEl.innerHTML = '';
                infoCardEl.appendChild(titleEl);
                infoCardEl.appendChild(contentEl);
            }
            
            // Retorna o nome do tipo de escala
            function getScaleTypeName(type) {
                const scaleNames = {
                    'major': 'Maior',
                    'minor': 'Menor',
                    'pentatonic_major': 'Pentatônica Maior',
                    'pentatonic_minor': 'Pentatônica Menor',
                    'pentatonic_minor_blue': 'Pentatônica Menor com Blue Note',
                    'pentatonic_major_blue': 'Pentatônica Maior com Blue Note',
                    'blues': 'Blues',
                    'ionian': 'Jônio (Maior)',
                    'dorian': 'Dórico',
                    'phrygian': 'Frígio',
                    'lydian': 'Lídio',
                    'mixolydian': 'Mixolídio',
                    'aeolian': 'Eólio (Menor)',
                    'locrian': 'Lócrio'
                };
                
                return scaleNames[type] || type;
            }
            
            // Gera os dados do braço da guitarra
            function generateFretboardData() {
                fretboardData = [];
                
                for (let stringIdx = 0; stringIdx < currentTuning.length; stringIdx++) {
                    const string = [];
                    const openNote = currentTuning[stringIdx];
                    const openNoteIdx = NOTES.indexOf(openNote);
                    
                    for (let fret = 0; fret <= NUM_FRETS; fret++) {
                        const noteIdx = (openNoteIdx + fret) % NOTES.length;
                        const note = NOTES[noteIdx];
                        
                        string.push({
                            note: note,
                            string: stringIdx + 1,
                            fret: fret
                        });
                    }
                    
                    fretboardData.push(string);
                }
                
                generateIntervalsData(rootNoteEl.value);
            }
            
            // Gera dados de intervalos
            function generateIntervalsData(root) {
                fretboardIntervalsData = [];
                const rootIdx = NOTES.indexOf(root);
                
                for (let stringIdx = 0; stringIdx < currentTuning.length; stringIdx++) {
                    const string = [];
                    const openNote = currentTuning[stringIdx];
                    const openNoteIdx = NOTES.indexOf(openNote);
                    
                    for (let fret = 0; fret <= NUM_FRETS; fret++) {
                        const noteIdx = (openNoteIdx + fret) % NOTES.length;
                        const note = NOTES[noteIdx];
                        
                        const interval = (noteIdx - rootIdx + 12) % 12;
                        const intervalName = INTERVAL_NAMES[interval];
                        
                        string.push({
                            note: note,
                            string: stringIdx + 1,
                            fret: fret,
                            interval: interval,
                            interval_name: intervalName
                        });
                    }
                    
                    fretboardIntervalsData.push(string);
                }
            }
            
            // Atualiza visibilidade dos controles
            function updateControlsVisibility() {
                // Atualizar o status de seleção
                updateSelectionStatus();
                
                scaleTypeGroupEl.style.display = (currentMode === 'scales' || currentMode === 'scale-triads') ? 'flex' : 'none';
                chordTypeGroupEl.style.display = currentMode === 'chord' ? 'flex' : 'none';
                triadsInfoEl.style.display = currentMode === 'scale-triads' ? 'block' : 'none';
                allTriadsInfoEl.style.display = currentMode === 'all-triads' ? 'block' : 'none';
                intervalsLegendEl.style.display = (showNotation === 'intervals' || currentMode === 'intervals') ? 'flex' : 'none';
            }
            
            // Atualiza o braço
            function updateFretboard() {
                document.querySelectorAll('.note').forEach(el => el.remove());
                
                const rootNote = rootNoteEl.value;
                
                generateIntervalsData(rootNote);
                updateSelectionStatus();
                
                if (currentMode === 'scales') {
                    generateScaleData(rootNote, scaleTypeEl.value);
                    renderNotes();
                } else if (currentMode === 'chord') {
                    generateChordData(rootNote, chordTypeEl.value);
                    renderNotes();
                } else if (currentMode === 'scale-triads') {
                    generateScaleData(rootNote, scaleTypeEl.value);
                    generateScaleTriads(rootNote, scaleTypeEl.value);
                    renderScaleTriads();
                } else if (currentMode === 'all-triads') {
                    generateAllTriads(rootNote);
                    renderAllTriads();
                } else if (currentMode === 'intervals') {
                    renderIntervals();
                } else {
                    renderNotes();
                }
                
                updateInfoCard();
            }
            
            // Função para limpar notas destacadas pelo usuário
            function clearHighlightedNotes() {
                userHighlightedNotes.clear();
                updateSelectionStatus();
                updateFretboard();
            }
            
            // Alternar destaque de uma nota
            function toggleHighlightNote(noteKey) {
                if (userHighlightedNotes.has(noteKey)) {
                    userHighlightedNotes.delete(noteKey);
                } else {
                    userHighlightedNotes.add(noteKey);
                }
                updateSelectionStatus();
                updateSingleNote(noteKey);
            }
            
            // Atualiza o status de seleção
            function updateSelectionStatus() {
                selectionStatusEl.textContent = `Clique em qualquer nota para destacá-la. Notas destacadas: ${userHighlightedNotes.size}`;
            }
            
            // Atualiza apenas a nota específica que foi clicada
            function updateSingleNote(noteKey) {
                const [stringNum, fret] = noteKey.split('-').map(Number);
                const fretEl = document.querySelector(`.fret[data-string="${stringNum}"][data-fret="${fret}"]`);
                
                if (fretEl) {
                    // Remove a nota atual
                    const existingNote = fretEl.querySelector('.note');
                    if (existingNote) {
                        existingNote.remove();
                    }
                    
                    // Recupera os dados da nota
                    const stringIdx = stringNum - 1;
                    const noteData = fretboardData[stringIdx].find(n => n.fret === fret);
                    const intervalData = fretboardIntervalsData[stringIdx].find(n => n.fret === fret);
                    
                    if (!noteData) return;
                    
                    const { note } = noteData;
                    const rootNote = rootNoteEl.value;
                    const isHighlighted = userHighlightedNotes.has(noteKey);
                    
                    // Recria a nota com o estado correto
                    let noteClass = 'note';
                    let displayText = note;
                    
                    if (isHighlighted) {
                        noteClass += ' user-highlighted';
                    } else {
                        // Aplica as classes normais baseadas no modo atual
                        if (currentMode === 'notes' || currentMode === 'intervals') {
                            if (note === rootNote) {
                                noteClass += ' root';
                            }
                        } else if (currentMode === 'scales' || currentMode === 'scale-triads') {
                            const scaleNotes = scaleData.notes || [];
                            const scaleType = scaleTypeEl.value;
                            
                            if (scaleNotes.includes(note)) {
                                if (note === rootNote) {
                                    noteClass += ' root';
                                } else {
                                    // Verificar se é uma blue note
                                    const rootIdx = NOTES.indexOf(rootNote);
                                    const noteIdx = NOTES.indexOf(note);
                                    const interval = (noteIdx - rootIdx + 12) % 12;
                                    
                                    if ((interval === 6) && 
                                       (scaleType === 'blues' || 
                                        scaleType === 'pentatonic_minor_blue' || 
                                        scaleType === 'pentatonic_major_blue')) {
                                        noteClass += ' blue-note';
                                    } else {
                                        noteClass += ' scale-note';
                                    }
                                }
                            }
                        } else if (currentMode === 'chord') {
                            const chordNotes = chordData.notes || [];
                            
                            if (chordNotes.includes(note)) {
                                if (note === rootNote) {
                                    noteClass += ' root';
                                } else {
                                    noteClass += ' chord-note';
                                }
                            }
                        } else if (currentMode === 'all-triads') {
                            const triadData = allTriads[currentTriadType];
                            
                            if (triadData && triadData.notes.includes(note)) {
                                if (note === rootNote) {
                                    noteClass += ' triad-note';
                                } else {
                                    noteClass += ` triad-${currentTriadType}`;
                                }
                            }
                        }
                    }
                    
                    // Determina o texto a ser exibido (notas ou intervalos)
                    if (showNotation === 'intervals' && !isHighlighted) {
                        if (intervalData) {
                            displayText = intervalData.interval_name;
                            noteClass += ` interval-${intervalData.interval_name}`;
                        }
                    }
                    
                    // Cria a nova nota
                    if (currentMode === 'notes' || currentMode === 'intervals' || isHighlighted || 
                        (currentMode === 'scales' && scaleData.notes && scaleData.notes.includes(note)) ||
                        (currentMode === 'chord' && chordData.notes && chordData.notes.includes(note)) ||
                        (currentMode === 'all-triads' && allTriads[currentTriadType] && allTriads[currentTriadType].notes.includes(note)) ||
                        (currentMode === 'scale-triads' && scaleData.notes && scaleData.notes.includes(note))) {
                        
                        const noteEl = document.createElement('div');
                        noteEl.className = noteClass;
                        noteEl.textContent = displayText;
                        
                        // Adiciona o evento de clique
                        noteEl.addEventListener('click', function(e) {
                            e.stopPropagation();
                            toggleHighlightNote(noteKey);
                        });
                        
                        fretEl.appendChild(noteEl);
                    }
                }
            }
            
            // Gera dados de escala
            function generateScaleData(root, scaleType) {
                const rootIdx = NOTES.indexOf(root);
                const scaleIntervals = SCALES[scaleType] || SCALES.major;
                
                let notes = [];
                let intervals = [];
                
                for (const interval of scaleIntervals) {
                    const noteIdx = (rootIdx + interval) % 12;
                    const note = NOTES[noteIdx];
                    
                    notes.push(note);
                    intervals.push({
                        interval: interval,
                        interval_name: INTERVAL_NAMES[interval],
                        note: note
                    });
                }
                
                scaleData = { notes, intervals };
            }
            
            // Gera dados de acorde
            function generateChordData(root, chordType) {
                const rootIdx = NOTES.indexOf(root);
                const chordIntervals = CHORDS[chordType] || CHORDS.major;
                
                let notes = [];
                let intervals = [];
                
                for (const interval of chordIntervals) {
                    const noteIdx = (rootIdx + interval) % 12;
                    const note = NOTES[noteIdx];
                    
                    notes.push(note);
                    intervals.push({
                        interval: interval,
                        interval_name: INTERVAL_NAMES[interval],
                        note: note
                    });
                }
                
                chordData = { notes, intervals };
            }
            
            // Gera dados de tríades da escala
            function generateScaleTriads(root, scaleType) {
                if (!scaleData.notes.length) {
                    generateScaleData(root, scaleType);
                }
                
                const scaleNotes = scaleData.notes;
                const triads = [];
                
                let triadTypes = [];
                if (scaleType === 'major' || scaleType === 'ionian') {
                    triadTypes = ['major', 'minor', 'minor', 'major', 'major', 'minor', 'dim'];
                } else if (scaleType === 'minor' || scaleType === 'aeolian') {
                    triadTypes = ['minor', 'dim', 'major', 'minor', 'minor', 'major', 'major'];
                } else {
                    for (let i = 0; i < scaleNotes.length; i++) {
                        const rootNote = scaleNotes[i];
                        const thirdIdx = (i + 2) % scaleNotes.length;
                        const fifthIdx = (i + 4) % scaleNotes.length;
                        
                        const thirdNote = scaleNotes[thirdIdx];
                        const fifthNote = scaleNotes[fifthIdx];
                        
                        const rootIdx = NOTES.indexOf(rootNote);
                        const thirdNoteIdx = NOTES.indexOf(thirdNote);
                        const fifthNoteIdx = NOTES.indexOf(fifthNote);
                        
                        const thirdInterval = (thirdNoteIdx - rootIdx + 12) % 12;
                        const fifthInterval = (fifthNoteIdx - rootIdx + 12) % 12;
                        
                        let triadType;
                        if (thirdInterval === 4 && fifthInterval === 7) {
                            triadType = 'major';
                        } else if (thirdInterval === 3 && fifthInterval === 7) {
                            triadType = 'minor';
                        } else if (thirdInterval === 3 && fifthInterval === 6) {
                            triadType = 'dim';
                        } else if (thirdInterval === 4 && fifthInterval === 8) {
                            triadType = 'aug';
                        } else {
                            triadType = 'unknown';
                        }
                        
                        triadTypes.push(triadType);
                    }
                }
                
                for (let i = 0; i < scaleNotes.length; i++) {
                    const rootNote = scaleNotes[i];
                    if (i < triadTypes.length) {
                        const triadType = triadTypes[i];
                        const triadNotes = generateChordNotes(rootNote, triadType);
                        
                        const triadIntervals = triadNotes.map(note => {
                            const noteIdx = NOTES.indexOf(note);
                            const rootNoteIdx = NOTES.indexOf(rootNote);
                            const interval = (noteIdx - rootNoteIdx + 12) % 12;
                            return {
                                interval: interval,
                                interval_name: INTERVAL_NAMES[interval],
                                note: note
                            };
                        });
                        
                        triads.push({
                            root: rootNote,
                            type: triadType,
                            notes: triadNotes,
                            intervals: triadIntervals,
                            degree: i + 1
                        });
                    }
                }
                
                scaleTriads = triads;
            }
            
            // Gera notas de um acorde
            function generateChordNotes(root, chordType) {
                const rootIdx = NOTES.indexOf(root);
                const intervals = CHORDS[chordType] || CHORDS.major;
                
                return intervals.map(interval => {
                    const noteIdx = (rootIdx + interval) % 12;
                    return NOTES[noteIdx];
                });
            }
            
            // Gera todos os tipos de tríades para uma nota
            function generateAllTriads(root) {
                const triadTypes = ['major', 'minor', 'dim', 'aug'];
                const triads = {};
                
                triadTypes.forEach(type => {
                    const notes = generateChordNotes(root, type);
                    
                    const intervals = notes.map(note => {
                        const noteIdx = NOTES.indexOf(note);
                        const rootIdx = NOTES.indexOf(root);
                        const interval = (noteIdx - rootIdx + 12) % 12;
                        return {
                            interval: interval,
                            interval_name: INTERVAL_NAMES[interval],
                            note: note
                        };
                    });
                    
                    triads[type] = { notes, intervals };
                });
                
                allTriads = triads;
                currentTriadType = 'major'; // Definir um tipo padrão
            }
            
            // Renderiza notas no braço
            function renderNotes() {
                const rootNote = rootNoteEl.value;
                
                fretboardData.forEach((string, stringIdx) => {
                    string.forEach((noteData, fretIdx) => {
                        const { note, string: stringNum, fret } = noteData;
                        const intervalData = fretboardIntervalsData[stringIdx][fretIdx];
                        
                        // Verificar se a nota está destacada pelo usuário
                        const noteKey = `${stringNum}-${fret}`;
                        const isHighlighted = userHighlightedNotes.has(noteKey);
                        
                        let showNote = false;
                        let noteClass = 'note';
                        let displayText = note;
                        
                        if (currentMode === 'notes') {
                            showNote = true;
                            if (note === rootNote && !isHighlighted) {
                                noteClass += ' root';
                            }
                            
                            if (showNotation === 'intervals') {
                                displayText = intervalData.interval_name;
                                if (!isHighlighted) {
                                    noteClass += ` interval-${intervalData.interval_name}`;
                                }
                            }
                        } else if (currentMode === 'scales') {
                            const scaleNotes = scaleData.notes || [];
                            const scaleType = scaleTypeEl.value;
                            
                            if (scaleNotes.includes(note)) {
                                showNote = true;
                                if (note === rootNote && !isHighlighted) {
                                    noteClass += ' root';
                                } else if (!isHighlighted) {
                                    // Verificar se é uma blue note
                                    const rootIdx = NOTES.indexOf(rootNote);
                                    const noteIdx = NOTES.indexOf(note);
                                    const interval = (noteIdx - rootIdx + 12) % 12;
                                    
                                    if ((interval === 6) && 
                                       (scaleType === 'blues' || 
                                        scaleType === 'pentatonic_minor_blue' || 
                                        scaleType === 'pentatonic_major_blue')) {
                                        noteClass += ' blue-note';
                                    } else {
                                        noteClass += ' scale-note';
                                    }
                                }
                                
                                if (showNotation === 'intervals') {
                                    const interval = scaleData.intervals.find(i => i.note === note);
                                    if (interval && !isHighlighted) {
                                        displayText = interval.interval_name;
                                        noteClass += ` interval-${interval.interval_name}`;
                                    }
                                }
                            }
                        } else if (currentMode === 'chord') {
                            const chordNotes = chordData.notes || [];
                            
                            if (chordNotes.includes(note)) {
                                showNote = true;
                                if (note === rootNote && !isHighlighted) {
                                    noteClass += ' root';
                                } else if (!isHighlighted) {
                                    noteClass += ' chord-note';
                                }
                                
                                if (showNotation === 'intervals') {
                                    const interval = chordData.intervals.find(i => i.note === note);
                                    if (interval && !isHighlighted) {
                                        displayText = interval.interval_name;
                                        noteClass += ` interval-${interval.interval_name}`;
                                    }
                                }
                            }
                        }
                        
                        // Garantir que mostra notas destacadas pelo usuário em qualquer modo
                        if (isHighlighted) {
                            showNote = true;
                            noteClass = 'note user-highlighted';
                        }
                        
                        // Exibe a nota se pertencer ao modo atual ou se estiver destacada
                        if (showNote) {
                            const fretEl = document.querySelector(`.fret[data-string="${stringNum}"][data-fret="${fret}"]`);
                            
                            if (fretEl) {
                                const noteEl = document.createElement('div');
                                noteEl.className = noteClass;
                                noteEl.textContent = displayText;
                                
                                // Adicionar evento de clique para destacar a nota
                                noteEl.addEventListener('click', function(e) {
                                    e.stopPropagation(); // Evita propagação para outros elementos
                                    toggleHighlightNote(noteKey);
                                });
                                
                                fretEl.appendChild(noteEl);
                            }
                        }
                    });
                });
            }
            
            // Renderiza intervalos
            function renderIntervals() {
                const rootNote = rootNoteEl.value;
                
                fretboardIntervalsData.forEach(string => {
                    string.forEach(noteData => {
                        const { note, string: stringNum, fret, interval_name } = noteData;
                        
                        // Verificar se a nota está destacada pelo usuário
                        const noteKey = `${stringNum}-${fret}`;
                        const isHighlighted = userHighlightedNotes.has(noteKey);
                        
                        const fretEl = document.querySelector(`.fret[data-string="${stringNum}"][data-fret="${fret}"]`);
                        
                        if (fretEl) {
                            const noteEl = document.createElement('div');
                            
                            if (isHighlighted) {
                                noteEl.className = 'note user-highlighted';
                            } else if (note === rootNote) {
                                noteEl.className = 'note root';
                            } else {
                                noteEl.className = `note interval-${interval_name}`;
                            }
                            
                            noteEl.textContent = showNotation === 'intervals' ? interval_name : note;
                            
                            // Adicionar evento de clique para destacar a nota
                            noteEl.addEventListener('click', function(e) {
                                e.stopPropagation();
                                toggleHighlightNote(noteKey);
                            });
                            
                            fretEl.appendChild(noteEl);
                        }
                    });
                });
            }
            
            // Renderiza tríades da escala
            function renderScaleTriads() {
                renderNotes();
                
                const triadsListEl = document.getElementById('triads-list');
                triadsListEl.innerHTML = '';
                
                scaleTriads.forEach((triad, index) => {
                    const triadEl = document.createElement('div');
                    triadEl.className = 'legend-item';
                    
                    const degreeBadge = document.createElement('span');
                    degreeBadge.className = `triad-badge triad-${getRomanNumeral(triad.degree).toLowerCase()}`;
                    degreeBadge.textContent = getRomanNumeral(triad.degree);
                    
                    const triadInfoEl = document.createElement('div');
                    triadInfoEl.className = 'triad-info';
                    triadInfoEl.title = "Visualizar";
                    
                    let chordName = triad.root;
                    switch(triad.type) {
                        case 'major': chordName += ''; break;
                        case 'minor': chordName += 'm'; break;
                        case 'dim': chordName += 'dim'; break;
                        case 'aug': chordName += 'aug'; break;
                        default: chordName += ' ' + triad.type; break;
                    }
                    
                    const noteNames = showNotation === 'notes' ? 
                        triad.notes.join(', ') : 
                        triad.intervals.map(i => i.interval_name).join(', ');
                    
                    triadInfoEl.textContent = `${chordName} (${noteNames})`;
                    
                    // Fazer o elemento de informações clicável
                    triadInfoEl.addEventListener('click', () => {
                        showTriadOnFretboard(triad, index);
                    });
                    
                    triadEl.appendChild(degreeBadge);
                    triadEl.appendChild(triadInfoEl);
                    triadsListEl.appendChild(triadEl);
                });
            }
            
            // Renderiza todos os tipos de tríades
            function renderAllTriads() {
                const allTriadsListEl = document.getElementById('all-triads-list');
                allTriadsListEl.innerHTML = '';
                
                const rootNote = rootNoteEl.value;
                const triadTypes = ['major', 'minor', 'dim', 'aug'];
                
                triadTypes.forEach(type => {
                    const triadEl = document.createElement('div');
                    triadEl.className = 'legend-item';
                    
                    const typeBadge = document.createElement('span');
                    typeBadge.className = `triad-badge triad-${type}`;
                    
                    // Traduz o tipo de tríade
                    let triadName;
                    switch(type) {
                        case 'major': triadName = 'Maior'; break;
                        case 'minor': triadName = 'Menor'; break;
                        case 'dim': triadName = 'Diminuta'; break;
                        case 'aug': triadName = 'Aumentada'; break;
                        default: triadName = type; break;
                    }
                    typeBadge.textContent = triadName;
                    
                    const triadInfoEl = document.createElement('div');
                    triadInfoEl.className = 'triad-info';
                    triadInfoEl.title = "Visualizar";
                    
                    const triadData = allTriads[type];
                    
                    let chordName = rootNote;
                    switch(type) {
                        case 'major': chordName += ''; break;
                        case 'minor': chordName += 'm'; break;
                        case 'dim': chordName += 'dim'; break;
                        case 'aug': chordName += 'aug'; break;
                        default: chordName += ' ' + type; break;
                    }
                    
                    const noteNames = showNotation === 'notes' ? 
                        triadData.notes.join(', ') : 
                        triadData.intervals.map(i => i.interval_name).join(', ');
                    
                    triadInfoEl.textContent = `${chordName} (${noteNames})`;
                    
                    // Fazer o elemento de informações clicável
                    triadInfoEl.addEventListener('click', () => {
                        showAllTriadType(type);
                    });
                    
                    triadEl.appendChild(typeBadge);
                    triadEl.appendChild(triadInfoEl);
                    allTriadsListEl.appendChild(triadEl);
                });
                
                showAllTriadType('major');
            }
            
            // Exibe uma tríade da escala no braço
            function showTriadOnFretboard(triad, triadIndex) {
                document.querySelectorAll('.note').forEach(el => el.remove());
                
                currentTriadIndex = triadIndex;
                
                fretboardData.forEach(string => {
                    string.forEach(noteData => {
                        const { note, string: stringNum, fret } = noteData;
                        
                        // Verificar se a nota está destacada pelo usuário
                        const noteKey = `${stringNum}-${fret}`;
                        const isHighlighted = userHighlightedNotes.has(noteKey);
                        
                        if (triad.notes.includes(note) || isHighlighted) {
                            const fretEl = document.querySelector(`.fret[data-string="${stringNum}"][data-fret="${fret}"]`);
                            
                            if (fretEl) {
                                const noteEl = document.createElement('div');
                                let displayText = note;
                                
                                if (isHighlighted) {
                                    noteEl.className = 'note user-highlighted';
                                } else if (note === triad.root) {
                                    noteEl.className = `note triad-note`;
                                } else {
                                    noteEl.className = `note chord-note`;
                                }
                                
                                if (showNotation === 'intervals' && !isHighlighted) {
                                    const interval = triad.intervals.find(i => i.note === note);
                                    if (interval) {
                                        displayText = interval.interval_name;
                                        noteEl.className += ` interval-${interval.interval_name}`;
                                    }
                                }
                                
                                noteEl.textContent = displayText;
                                
                                // Adicionar evento de clique para destacar a nota
                                noteEl.addEventListener('click', function(e) {
                                    e.stopPropagation();
                                    toggleHighlightNote(noteKey);
                                });
                                
                                fretEl.appendChild(noteEl);
                            }
                        }
                    });
                });
                
                // Atualizar o card de informações para a tríade selecionada
                const titleEl = document.createElement('h4');
                titleEl.textContent = `Tríade ${getRomanNumeral(triad.degree)} - ${getTriadName(triad.type)} (${triad.root})`;
                
                const contentEl = document.createElement('p');
                contentEl.textContent = `Visualizando a tríade ${getTriadName(triad.type)} construída sobre o grau ${getRomanNumeral(triad.degree)} da escala. Notas: ${triad.notes.join(', ')}`;
                
                infoCardEl.innerHTML = '';
                infoCardEl.appendChild(titleEl);
                infoCardEl.appendChild(contentEl);
            }
            
            // Exibe um tipo de tríade no braço
            function showAllTriadType(triadType) {
                document.querySelectorAll('.note').forEach(el => el.remove());
                
                currentTriadType = triadType;
                const triadData = allTriads[triadType];
                const rootNote = rootNoteEl.value;
                
                fretboardData.forEach(string => {
                    string.forEach(noteData => {
                        const { note, string: stringNum, fret } = noteData;
                        
                        // Verificar se a nota está destacada pelo usuário
                        const noteKey = `${stringNum}-${fret}`;
                        const isHighlighted = userHighlightedNotes.has(noteKey);
                        
                        if (triadData.notes.includes(note) || isHighlighted) {
                            const fretEl = document.querySelector(`.fret[data-string="${stringNum}"][data-fret="${fret}"]`);
                            
                            if (fretEl) {
                                const noteEl = document.createElement('div');
                                let displayText = note;
                                
                                if (isHighlighted) {
                                    noteEl.className = 'note user-highlighted';
                                } else if (note === rootNote) {
                                    noteEl.className = `note triad-note`;
                                } else {
                                    noteEl.className = `note triad-${triadType}`;
                                }
                                
                                if (showNotation === 'intervals' && !isHighlighted) {
                                    const interval = triadData.intervals.find(i => i.note === note);
                                    if (interval) {
                                        displayText = interval.interval_name;
                                        noteEl.className += ` interval-${interval.interval_name}`;
                                    }
                                }
                                
                                noteEl.textContent = displayText;
                                
                                // Adicionar evento de clique para destacar a nota
                                noteEl.addEventListener('click', function(e) {
                                    e.stopPropagation();
                                    toggleHighlightNote(noteKey);
                                });
                                
                                fretEl.appendChild(noteEl);
                            }
                        }
                    });
                });
                
                // Atualizar o card de informações para o tipo de tríade selecionado
                const titleEl = document.createElement('h4');
                titleEl.textContent = `Tríade ${getTriadName(triadType)} - ${rootNote}${getChordSuffix(triadType)}`;
                
                const contentEl = document.createElement('p');
                contentEl.textContent = `Visualizando a tríade ${getTriadName(triadType)} para a nota raiz ${rootNote}. Notas: ${triadData.notes.join(', ')}`;
                
                infoCardEl.innerHTML = '';
                infoCardEl.appendChild(titleEl);
                infoCardEl.appendChild(contentEl);
            }
            
            // Função para converter número para numeral romano
            function getRomanNumeral(num) {
                const romanNumerals = ['I', 'II', 'III', 'IV', 'V', 'VI', 'VII'];
                return romanNumerals[num - 1] || num.toString();
            }
            
            // Obter nome do tipo de tríade
            function getTriadName(type) {
                const triadNames = {
                    'major': 'Maior',
                    'minor': 'Menor',
                    'dim': 'Diminuta',
                    'aug': 'Aumentada'
                };
                return triadNames[type] || type;
            }
            
            // Obter sufixo do acorde baseado no tipo
            function getChordSuffix(type) {
                const suffixes = {
                    'major': '',
                    'minor': 'm',
                    'dim': 'dim',
                    'aug': 'aug',
                    '7': '7',
                    'maj7': 'maj7',
                    'm7': 'm7',
                    'm7b5': 'm7b5'
                };
                return suffixes[type] || '';
            }
            
            // Obter nome do acorde
            function getChordName(root, chordType) {
                return root + getChordSuffix(chordType);
            }
        });
    </script>
</body>
</html>
