<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    
    <title>Guitar Fretboard Visualizer - Visualize Escalas e Acordes na Guitarra</title>
    
    <!-- Meta descrição -->
    <meta name="description" content="Visualize escalas, acordes e notas no braço da guitarra com o Guitar Fretboard Visualizer. Ideal para iniciantes e músicos avançados. Explore modos, tonalidades e afinações.">
    
    <!-- Palavras-chave relevantes -->
    <meta name="keywords" content="guitarra, escalas, acordes, braço da guitarra, triades guitarra, escala de blues, visualizador de escalas, modos musicais, teoria musical, afinação, guitarra online, fretboard visualizer">
    
    <!-- Meta tags para redes sociais (Open Graph e Twitter Cards) -->
    <meta property="og:title" content="Guitar Fretboard Visualizer">
    <meta property="og:description" content="Ferramenta online para visualizar escalas e acordes no braço da guitarra. Aprenda teoria musical com praticidade.">
    <meta property="og:url" content="https://guitar-fretboard-visualizer.onrender.com/">
    <meta property="og:type" content="website">
    
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Guitar Fretboard Visualizer">
    <meta name="twitter:description" content="Visualizador de escalas e acordes para guitarra. Interativo, gratuito e online.">
    
    <style>
        /* Reset e estilos gerais */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        h1 {
            text-align: center;
            color: #333;
            font-size: 24px;
            margin: 20px 0;
        }
        
        /* Estilos dos controles */
        .controls {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
            padding: 15px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
            width: 150px;
        }
        
        label {
            margin-bottom: 5px;
            font-weight: bold;
            font-size: 14px;
        }
        
        select, button {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            width: 100%;
        }
        
        button {
            background-color: #4285f4;
            color: white;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #3367d6;
        }
        
        .toggle-group {
            display: flex;
            gap: 5px;
            margin-top: 5px;
        }
        
        .toggle-btn {
            flex: 1;
            padding: 5px;
            font-size: 12px;
            background-color: #e0e0e0;
            color: #333;
        }
        
        .toggle-btn.active {
            background-color: #4285f4;
            color: white;
        }
        
        /* Estilos do braço da guitarra */
        .fretboard-container {
            overflow-x: auto;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .fretboard {
            display: table;
            border-collapse: collapse;
            width: 100%;
        }
        
        .string {
            display: table-row;
            height: 50px;
        }
        
        .fret {
            display: table-cell;
            width: 60px;
            border-right: 2px solid #bbb;
            position: relative;
            text-align: center;
            vertical-align: middle;
        }
        
        /* Estilo para destacar o traste 0 (cordas soltas) */
        .fret[data-fret="0"] {
            background-color: #e8e8e8;
            border-right: 2px solid #999;
        }
        
        .string:not(:last-child) .fret {
            border-bottom: 1px solid #ddd;
        }
        
        .fret-number {
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 12px;
            color: #666;
        }
        
        .string-name {
            width: 30px;
            display: table-cell;
            text-align: center;
            font-weight: bold;
            background-color: #ddd;
            color: #333;
            font-size: 14px;
        }
        
        .note {
            display: inline-block;
            width: 30px;
            height: 30px;
            line-height: 30px;
            border-radius: 50%;
            background-color: #f44336;
            color: white;
            font-weight: bold;
            text-align: center;
            font-size: 12px;
        }
        
        /* Estilos da legenda */
        .legend {
            margin-top: 40px;
            padding: 15px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .legend h3 {
            margin-top: 0;
            font-size: 18px;
            margin-bottom: 15px;
        }
        
        .legend-items {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 14px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            flex-shrink: 0;
        }
        
        /* Botão menor para as tríades - Removido */
        
        /* Layout horizontal para as notas das tríades - agora clicável */
        .triad-info {
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 3px;
            flex-wrap: nowrap;
            min-width: 200px;
            cursor: pointer;
            padding: 3px 6px;
            border-radius: 3px;
            transition: background-color 0.2s;
        }
        
        .triad-info:hover {
            background-color: #e0e0e0;
        }
        
        /* Cores para as notas */
        .root {
            background-color: #f44336;
        }
        
        .scale-note {
            background-color: #4caf50;
        }
        
        .chord-note {
            background-color: #2196f3;
        }
        
        .triad-note {
            background-color: #f44336;
        }
        
        /* Cores para os intervalos */
        .interval-1P {
            background-color: #f44336; /* Vermelho - Fundamental */
        }
        
        .interval-2m, .interval-2M {
            background-color: #ff9800; /* Laranja - Segundas */
        }
        
        .interval-3m, .interval-3M {
            background-color: #ffeb3b; /* Amarelo - Terças */
        }
        
        .interval-4P {
            background-color: #8bc34a; /* Verde claro - Quarta */
        }
        
        .interval-Tr {
            background-color: #009688; /* Teal - Trítono */
        }
        
        .interval-5P {
            background-color: #2196f3; /* Azul - Quinta */
        }
        
        .interval-6m, .interval-6M {
            background-color: #673ab7; /* Roxo - Sextas */
        }
        
        .interval-7m, .interval-7M {
            background-color: #9c27b0; /* Rosa - Sétimas */
        }
        
        /* Cores para as tríades */
        .triad-i, .triad-major {
            background-color: #4caf50;
        }
        
        .triad-ii, .triad-minor {
            background-color: #2196f3;
        }
        
        .triad-iii, .triad-dim {
            background-color: #9c27b0;
        }
        
        .triad-iv, .triad-aug {
            background-color: #ff9800;
        }
        
        .triad-v {
            background-color: #2196f3;
        }
        
        .triad-vi {
            background-color: #9c27b0;
        }
        
        .triad-vii {
            background-color: #795548;
        }
        
        .triad-badge {
            display: inline-block;
            padding: 3px 6px;
            margin-right: 5px;
            border-radius: 4px;
            color: white;
            font-weight: bold;
            font-size: 12px;
        }
        
        .intervals-legend {
            margin-top: 15px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .interval-badge {
            padding: 3px 6px;
            border-radius: 4px;
            color: white;
            font-weight: bold;
            font-size: 12px;
        }
    </style>
</head>

<body>
    <h1 data-lang-pt="Visualizador de Braço de Guitarra v6" data-lang-en="Guitar Fretboard Visualizer v6" data-lang-es="Visualizador de Mástil de Guitarra v6">Visualizador de Braço de Guitarra v6</h1>
    
    <div class="controls">
        <div class="control-group">
            <label for="display-mode" data-lang-pt="Modo de Exibição:" data-lang-en="Display Mode:" data-lang-es="Modo de Visualización:">Modo de Exibição:</label>
            <select id="display-mode">
                <option value="notes" data-lang-pt="Todas as Notas" data-lang-en="All Notes" data-lang-es="Todas las Notas">Todas as Notas</option>
                <option value="intervals" data-lang-pt="Intervalos" data-lang-en="Intervals" data-lang-es="Intervalos">Intervalos</option>
                <option value="scale" data-lang-pt="Escala" data-lang-en="Scale" data-lang-es="Escala">Escala</option>
                <option value="chord" data-lang-pt="Acorde" data-lang-en="Chord" data-lang-es="Acorde">Acorde</option>
                <option value="scale-triads" data-lang-pt="Tríades da Escala" data-lang-en="Scale Triads" data-lang-es="Tríadas de la Escala">Tríades da Escala</option>
                <option value="all-triads" data-lang-pt="Todos os Tipos de Tríades" data-lang-en="All Triad Types" data-lang-es="Todos los Tipos de Tríadas">Todos os Tipos de Tríades</option>
            </select>
        </div>
        
        <div class="control-group">
            <label for="root-note" data-lang-pt="Nota Raiz:" data-lang-en="Root Note:" data-lang-es="Nota Raíz:">Nota Raiz:</label>
            <select id="root-note">
                <option value="C">C</option>
                <option value="C#">C#</option>
                <option value="D">D</option>
                <option value="D#">D#</option>
                <option value="E">E</option>
                <option value="F">F</option>
                <option value="F#">F#</option>
                <option value="G">G</option>
                <option value="G#">G#</option>
                <option value="A">A</option>
                <option value="A#">A#</option>
                <option value="B">B</option>
            </select>
        </div>
        
        <div class="control-group" id="scale-type-group">
            <label for="scale-type" data-lang-pt="Tipo de Escala:" data-lang-en="Scale Type:" data-lang-es="Tipo de Escala:">Tipo de Escala:</label>
            <select id="scale-type">
                <option value="major" data-lang-pt="Maior" data-lang-en="Major" data-lang-es="Mayor">Maior</option>
                <option value="minor" data-lang-pt="Menor" data-lang-en="Minor" data-lang-es="Menor">Menor</option>
                <option value="pentatonic_major" data-lang-pt="Pentatônica Maior" data-lang-en="Major Pentatonic" data-lang-es="Pentatónica Mayor">Pentatônica Maior</option>
                <option value="pentatonic_minor" data-lang-pt="Pentatônica Menor" data-lang-en="Minor Pentatonic" data-lang-es="Pentatónica Menor">Pentatônica Menor</option>
                <option value="blues" data-lang-pt="Blues" data-lang-en="Blues" data-lang-es="Blues">Blues</option>
            </select>
        </div>
        
        <div class="control-group" id="chord-type-group" style="display: none;">
            <label for="chord-type" data-lang-pt="Tipo de Acorde:" data-lang-en="Chord Type:" data-lang-es="Tipo de Acorde:">Tipo de Acorde:</label>
            <select id="chord-type">
                <option value="major" data-lang-pt="Maior" data-lang-en="Major" data-lang-es="Mayor">Maior</option>
                <option value="minor" data-lang-pt="Menor" data-lang-en="Minor" data-lang-es="Menor">Menor</option>
                <option value="7" data-lang-pt="Dominante 7" data-lang-en="Dominant 7" data-lang-es="Dominante 7">Dominante 7</option>
                <option value="maj7" data-lang-pt="Maior 7" data-lang-en="Major 7" data-lang-es="Mayor 7">Maior 7</option>
                <option value="m7" data-lang-pt="Menor 7" data-lang-en="Minor 7" data-lang-es="Menor 7">Menor 7</option>
                <option value="dim" data-lang-pt="Diminuto" data-lang-en="Diminished" data-lang-es="Disminuido">Diminuto</option>
                <option value="aug" data-lang-pt="Aumentado" data-lang-en="Augmented" data-lang-es="Aumentado">Aumentado</option>
                <option value="m7b5" data-lang-pt="Meio-Diminuto (m7b5)" data-lang-en="Half-Diminished (m7b5)" data-lang-es="Semi-Disminuido (m7b5)">Meio-Diminuto (m7b5)</option>
            </select>
        </div>
        
        <div class="control-group">
            <label for="display-toggle" data-lang-pt="Exibir:" data-lang-en="Display:" data-lang-es="Mostrar:">Exibir:</label>
            <div class="toggle-group" id="display-toggle">
                <button class="toggle-btn active" data-show="notes" data-lang-pt="Notas" data-lang-en="Notes" data-lang-es="Notas">Notas</button>
                <button class="toggle-btn" data-show="intervals" data-lang-pt="Intervalos" data-lang-en="Intervals" data-lang-es="Intervalos">Intervalos</button>
            </div>
        </div>
        
        <div class="control-group">
            <label>&nbsp;</label>
            <button id="update-button" data-lang-pt="Atualizar" data-lang-en="Update" data-lang-es="Actualizar">Atualizar</button>
        </div>
    </div>
    
    <div class="fretboard-container">
        <div class="fretboard" id="fretboard">
            <!-- O braço da guitarra será gerado dinamicamente via JavaScript -->
        </div>
    </div>
    
    <div class="legend">
        <h3 data-lang-pt="Legenda" data-lang-en="Legend" data-lang-es="Leyenda">Legenda</h3>
        <div class="legend-items">
            <div class="legend-item">
                <div class="legend-color root"></div>
                <span data-lang-pt="Nota Raiz" data-lang-en="Root Note" data-lang-es="Nota Raíz">Nota Raiz</span>
            </div>
            <div class="legend-item">
                <div class="legend-color scale-note"></div>
                <span data-lang-pt="Nota da Escala" data-lang-en="Scale Note" data-lang-es="Nota de la Escala">Nota da Escala</span>
            </div>
            <div class="legend-item">
                <div class="legend-color chord-note"></div>
                <span data-lang-pt="Nota do Acorde" data-lang-en="Chord Note" data-lang-es="Nota del Acorde">Nota do Acorde</span>
            </div>
            <div class="legend-item">
                <div class="legend-color triad-note"></div>
                <span data-lang-pt="Nota da Tríade" data-lang-en="Triad Note" data-lang-es="Nota de la Tríada">Nota da Tríade</span>
            </div>
            <div class="legend-item" style="background-color: #e8e8e8; padding: 5px; border-radius: 4px;">
                <span data-lang-pt="Cordas Soltas (Traste 0)" data-lang-en="Open Strings (Fret 0)" data-lang-es="Cuerdas al Aire (Traste 0)">Cordas Soltas (Traste 0)</span>
            </div>
        </div>
        
        <div id="intervals-legend" class="intervals-legend" style="display: none;">
            <h4 data-lang-pt="Intervalos:" data-lang-en="Intervals:" data-lang-es="Intervalos:">Intervalos:</h4>
            <div class="interval-badge interval-1P">1P</div>
            <div class="interval-badge interval-2m">2m</div>
            <div class="interval-badge interval-2M">2M</div>
            <div class="interval-badge interval-3m">3m</div>
            <div class="interval-badge interval-3M">3M</div>
            <div class="interval-badge interval-4P">4P</div>
            <div class="interval-badge interval-Tr">Tr</div>
            <div class="interval-badge interval-5P">5P</div>
            <div class="interval-badge interval-6m">6m</div>
            <div class="interval-badge interval-6M">6M</div>
            <div class="interval-badge interval-7m">7m</div>
            <div class="interval-badge interval-7M">7M</div>
        </div>
    </div>
    
    <div id="triads-info" class="legend" style="display: none;">
        <h3 data-lang-pt="Tríades da Escala" data-lang-en="Scale Triads" data-lang-es="Tríadas de la Escala">Tríades da Escala</h3>
        <div id="triads-list" class="legend-items">
            <!-- Lista de tríades será gerada dinamicamente -->
        </div>
    </div>
    
    <div id="all-triads-info" class="legend" style="display: none;">
        <h3 data-lang-pt="Tipos de Tríades" data-lang-en="Triad Types" data-lang-es="Tipos de Tríadas">Tipos de Tríades</h3>
        <div id="all-triads-list" class="legend-items">
            <!-- Lista de todos os tipos de tríades será gerada dinamicamente -->
        </div>
    </div>
    
    <footer style="text-align: center; margin-top: 30px; padding: 15px; color: #666; font-size: 14px; border-top: 1px solid #ddd;">
        &copy; 2025 <span data-lang-pt="Direitos Autorais" data-lang-en="Copyright" data-lang-es="Derechos de Autor">Direitos Autorais</span> - Fabio Alberti (<a href="mailto:fabiocax@gmail.com" style="color: #4285f4; text-decoration: none;">fabiocax@gmail.com</a>)
    </footer>
    
    <script>
        // Definições globais
        const NOTES = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];
        const STANDARD_TUNING = ['E', 'B', 'G', 'D', 'A', 'E'];
        const NUM_FRETS = 12;
        
        // Definição de intervalos
        const INTERVAL_NAMES = {
            0: '1P', 1: '2m', 2: '2M', 3: '3m', 4: '3M', 5: '4P', 
            6: 'Tr', 7: '5P', 8: '6m', 9: '6M', 10: '7m', 11: '7M'
        };
        
        // Definição de escalas
        const SCALES = {
            'major': [0, 2, 4, 5, 7, 9, 11],
            'minor': [0, 2, 3, 5, 7, 8, 10],
            'pentatonic_major': [0, 2, 4, 7, 9],
            'pentatonic_minor': [0, 3, 5, 7, 10],
            'blues': [0, 3, 5, 6, 7, 10]
        };
        
        // Definição de acordes
        const CHORDS = {
            'major': [0, 4, 7],
            'minor': [0, 3, 7],
            'dim': [0, 3, 6],
            'aug': [0, 4, 8],
            '7': [0, 4, 7, 10],
            'maj7': [0, 4, 7, 11],
            'm7': [0, 3, 7, 10],
            'm7b5': [0, 3, 6, 10]
        };
        
        // Traduções
        const TRANSLATIONS = {
            'pt': {
                'showButton': 'Visualizar',
                'triadNames': {
                    'major': 'Maior',
                    'minor': 'Menor',
                    'dim': 'Diminuta',
                    'aug': 'Aumentada'
                }
            },
            'en': {
                'showButton': 'View',
                'triadNames': {
                    'major': 'Major',
                    'minor': 'Minor',
                    'dim': 'Diminished',
                    'aug': 'Augmented'
                }
            },
            'es': {
                'showButton': 'Ver',
                'triadNames': {
                    'major': 'Mayor',
                    'minor': 'Menor',
                    'dim': 'Disminuida',
                    'aug': 'Aumentada'
                }
            }
        };
        
        // Elementos DOM
        const fretboardEl = document.getElementById('fretboard');
        const displayModeEl = document.getElementById('display-mode');
        const rootNoteEl = document.getElementById('root-note');
        const scaleTypeEl = document.getElementById('scale-type');
        const chordTypeEl = document.getElementById('chord-type');
        const scaleTypeGroupEl = document.getElementById('scale-type-group');
        const chordTypeGroupEl = document.getElementById('chord-type-group');
        const updateButtonEl = document.getElementById('update-button');
        const displayToggleEl = document.getElementById('display-toggle');
        const intervalsLegendEl = document.getElementById('intervals-legend');
        const triadsInfoEl = document.getElementById('triads-info');
        const allTriadsInfoEl = document.getElementById('all-triads-info');
        
        // Estado da aplicação
        let fretboardData = [];
        let fretboardIntervalsData = [];
        let scaleData = { notes: [], intervals: [] };
        let chordData = { notes: [], intervals: [] };
        let scaleTriads = [];
        let allTriads = {};
        let currentTriadIndex = 0;
        let currentTriadType = '';
        let showNotation = 'notes';
        let currentLanguage = 'pt';
        
        // Detectar idioma do navegador
        function detectBrowserLanguage() {
            let browserLang = navigator.language || navigator.userLanguage;
            browserLang = browserLang.substring(0, 2).toLowerCase();
            
            if (browserLang === 'pt' || browserLang === 'en' || browserLang === 'es') {
                currentLanguage = browserLang;
            } else {
                currentLanguage = 'en';
            }
        }
        
        // Função para mudar o idioma
        function changeLanguage() {
            document.querySelectorAll('[data-lang-' + currentLanguage + ']').forEach(el => {
                el.textContent = el.getAttribute('data-lang-' + currentLanguage);
            });
            
            document.querySelectorAll('option[data-lang-' + currentLanguage + ']').forEach(option => {
                option.textContent = option.getAttribute('data-lang-' + currentLanguage);
            });
            
            document.querySelectorAll('#display-toggle .toggle-btn').forEach(btn => {
                btn.textContent = btn.getAttribute('data-lang-' + currentLanguage);
            });
            
            updateButtonEl.textContent = updateButtonEl.getAttribute('data-lang-' + currentLanguage);
            document.documentElement.lang = currentLanguage;
            updateFretboard();
        }
        
        // Inicialização
        function init() {
            detectBrowserLanguage();
            initFretboard();
            
            displayModeEl.addEventListener('change', updateControlsVisibility);
            updateButtonEl.addEventListener('click', updateFretboard);
            
            const toggleBtns = displayToggleEl.querySelectorAll('.toggle-btn');
            toggleBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    toggleBtns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    showNotation = this.dataset.show;
                    updateFretboard();
                });
            });
            
            updateControlsVisibility();
            generateFretboardData();
            changeLanguage();
            updateFretboard();
        }
        
        // Cria o braço da guitarra no DOM
        function initFretboard() {
            fretboardEl.innerHTML = '';
            
            for (let i = 0; i < STANDARD_TUNING.length; i++) {
                const stringEl = document.createElement('div');
                stringEl.className = 'string';
                
                const stringNameEl = document.createElement('div');
                stringNameEl.className = 'string-name';
                stringNameEl.textContent = STANDARD_TUNING[i];
                stringEl.appendChild(stringNameEl);
                
                for (let j = 0; j <= NUM_FRETS; j++) {
                    const fretEl = document.createElement('div');
                    fretEl.className = 'fret';
                    fretEl.dataset.string = i + 1;
                    fretEl.dataset.fret = j;
                    
                    if (i === 0) {
                        const fretNumberEl = document.createElement('div');
                        fretNumberEl.className = 'fret-number';
                        fretNumberEl.textContent = j;
                        fretEl.appendChild(fretNumberEl);
                    }
                    
                    stringEl.appendChild(fretEl);
                }
                
                fretboardEl.appendChild(stringEl);
            }
        }
        
        // Gera os dados do braço da guitarra
        function generateFretboardData() {
            fretboardData = [];
            
            for (let stringIdx = 0; stringIdx < STANDARD_TUNING.length; stringIdx++) {
                const string = [];
                const openNote = STANDARD_TUNING[stringIdx];
                const openNoteIdx = NOTES.indexOf(openNote);
                
                for (let fret = 0; fret <= NUM_FRETS; fret++) {
                    const noteIdx = (openNoteIdx + fret) % NOTES.length;
                    const note = NOTES[noteIdx];
                    
                    string.push({
                        note: note,
                        string: stringIdx + 1,
                        fret: fret
                    });
                }
                
                fretboardData.push(string);
            }
            
            generateIntervalsData(rootNoteEl.value);
        }
        
        // Gera dados de intervalos
        function generateIntervalsData(root) {
            fretboardIntervalsData = [];
            const rootIdx = NOTES.indexOf(root);
            
            for (let stringIdx = 0; stringIdx < STANDARD_TUNING.length; stringIdx++) {
                const string = [];
                const openNote = STANDARD_TUNING[stringIdx];
                const openNoteIdx = NOTES.indexOf(openNote);
                
                for (let fret = 0; fret <= NUM_FRETS; fret++) {
                    const noteIdx = (openNoteIdx + fret) % NOTES.length;
                    const note = NOTES[noteIdx];
                    
                    const interval = (noteIdx - rootIdx + 12) % 12;
                    const intervalName = INTERVAL_NAMES[interval];
                    
                    string.push({
                        note: note,
                        string: stringIdx + 1,
                        fret: fret,
                        interval: interval,
                        interval_name: intervalName
                    });
                }
                
                fretboardIntervalsData.push(string);
            }
        }
        
        // Atualiza visibilidade dos controles
        function updateControlsVisibility() {
            const mode = displayModeEl.value;
            
            scaleTypeGroupEl.style.display = (mode === 'scale' || mode === 'scale-triads') ? 'flex' : 'none';
            chordTypeGroupEl.style.display = mode === 'chord' ? 'flex' : 'none';
            triadsInfoEl.style.display = mode === 'scale-triads' ? 'block' : 'none';
            allTriadsInfoEl.style.display = mode === 'all-triads' ? 'block' : 'none';
            intervalsLegendEl.style.display = (showNotation === 'intervals' || mode === 'intervals') ? 'flex' : 'none';
        }
        
        // Atualiza o braço
        function updateFretboard() {
            document.querySelectorAll('.note').forEach(el => el.remove());
            
            const mode = displayModeEl.value;
            const rootNote = rootNoteEl.value;
            
            generateIntervalsData(rootNote);
            
            if (mode === 'scale') {
                generateScaleData(rootNote, scaleTypeEl.value);
                renderNotes();
            } else if (mode === 'chord') {
                generateChordData(rootNote, chordTypeEl.value);
                renderNotes();
            } else if (mode === 'scale-triads') {
                generateScaleData(rootNote, scaleTypeEl.value);
                generateScaleTriads(rootNote, scaleTypeEl.value);
                renderScaleTriads();
            } else if (mode === 'all-triads') {
                generateAllTriads(rootNote);
                renderAllTriads();
            } else if (mode === 'intervals') {
                renderIntervals();
            } else {
                renderNotes();
            }
        }
        
        // Gera dados de escala
        function generateScaleData(root, scaleType) {
            const rootIdx = NOTES.indexOf(root);
            const scaleIntervals = SCALES[scaleType] || SCALES.major;
            
            let notes = [];
            let intervals = [];
            
            for (const interval of scaleIntervals) {
                const noteIdx = (rootIdx + interval) % 12;
                const note = NOTES[noteIdx];
                
                notes.push(note);
                intervals.push({
                    interval: interval,
                    interval_name: INTERVAL_NAMES[interval],
                    note: note
                });
            }
            
            scaleData = { notes, intervals };
        }
        
        // Gera dados de acorde
        function generateChordData(root, chordType) {
            const rootIdx = NOTES.indexOf(root);
            const chordIntervals = CHORDS[chordType] || CHORDS.major;
            
            let notes = [];
            let intervals = [];
            
            for (const interval of chordIntervals) {
                const noteIdx = (rootIdx + interval) % 12;
                const note = NOTES[noteIdx];
                
                notes.push(note);
                intervals.push({
                    interval: interval,
                    interval_name: INTERVAL_NAMES[interval],
                    note: note
                });
            }
            
            chordData = { notes, intervals };
        }
        
        // Gera dados de tríades da escala
        function generateScaleTriads(root, scaleType) {
            if (!scaleData.notes.length) {
                generateScaleData(root, scaleType);
            }
            
            const scaleNotes = scaleData.notes;
            const triads = [];
            
            let triadTypes = [];
            if (scaleType === 'major') {
                triadTypes = ['major', 'minor', 'minor', 'major', 'major', 'minor', 'dim'];
            } else if (scaleType === 'minor') {
                triadTypes = ['minor', 'dim', 'major', 'minor', 'minor', 'major', 'major'];
            } else {
                for (let i = 0; i < scaleNotes.length; i++) {
                    const rootNote = scaleNotes[i];
                    const thirdIdx = (i + 2) % scaleNotes.length;
                    const fifthIdx = (i + 4) % scaleNotes.length;
                    
                    const thirdNote = scaleNotes[thirdIdx];
                    const fifthNote = scaleNotes[fifthIdx];
                    
                    const rootIdx = NOTES.indexOf(rootNote);
                    const thirdNoteIdx = NOTES.indexOf(thirdNote);
                    const fifthNoteIdx = NOTES.indexOf(fifthNote);
                    
                    const thirdInterval = (thirdNoteIdx - rootIdx + 12) % 12;
                    const fifthInterval = (fifthNoteIdx - rootIdx + 12) % 12;
                    
                    let triadType;
                    if (thirdInterval === 4 && fifthInterval === 7) {
                        triadType = 'major';
                    } else if (thirdInterval === 3 && fifthInterval === 7) {
                        triadType = 'minor';
                    } else if (thirdInterval === 3 && fifthInterval === 6) {
                        triadType = 'dim';
                    } else if (thirdInterval === 4 && fifthInterval === 8) {
                        triadType = 'aug';
                    } else {
                        triadType = 'unknown';
                    }
                    
                    triadTypes.push(triadType);
                }
            }
            
            for (let i = 0; i < scaleNotes.length; i++) {
                const rootNote = scaleNotes[i];
                if (i < triadTypes.length) {
                    const triadType = triadTypes[i];
                    const triadNotes = generateChordNotes(rootNote, triadType);
                    
                    const triadIntervals = triadNotes.map(note => {
                        const noteIdx = NOTES.indexOf(note);
                        const rootNoteIdx = NOTES.indexOf(rootNote);
                        const interval = (noteIdx - rootNoteIdx + 12) % 12;
                        return {
                            interval: interval,
                            interval_name: INTERVAL_NAMES[interval],
                            note: note
                        };
                    });
                    
                    triads.push({
                        root: rootNote,
                        type: triadType,
                        notes: triadNotes,
                        intervals: triadIntervals,
                        degree: i + 1
                    });
                }
            }
            
            scaleTriads = triads;
        }
        
        // Gera notas de um acorde
        function generateChordNotes(root, chordType) {
            const rootIdx = NOTES.indexOf(root);
            const intervals = CHORDS[chordType] || CHORDS.major;
            
            return intervals.map(interval => {
                const noteIdx = (rootIdx + interval) % 12;
                return NOTES[noteIdx];
            });
        }
        
        // Gera todos os tipos de tríades para uma nota
        function generateAllTriads(root) {
            const triadTypes = ['major', 'minor', 'dim', 'aug'];
            const triads = {};
            
            triadTypes.forEach(type => {
                const notes = generateChordNotes(root, type);
                
                const intervals = notes.map(note => {
                    const noteIdx = NOTES.indexOf(note);
                    const rootIdx = NOTES.indexOf(root);
                    const interval = (noteIdx - rootIdx + 12) % 12;
                    return {
                        interval: interval,
                        interval_name: INTERVAL_NAMES[interval],
                        note: note
                    };
                });
                
                triads[type] = { notes, intervals };
            });
            
            allTriads = triads;
        }
        
        // Renderiza notas no braço
        function renderNotes() {
            const mode = displayModeEl.value;
            const rootNote = rootNoteEl.value;
            
            fretboardData.forEach((string, stringIdx) => {
                string.forEach((noteData, fretIdx) => {
                    const { note, string: stringNum, fret } = noteData;
                    const intervalData = fretboardIntervalsData[stringIdx][fretIdx];
                    
                    let showNote = false;
                    let noteClass = 'note';
                    let displayText = note;
                    
                    if (mode === 'notes') {
                        showNote = true;
                        if (note === rootNote) {
                            noteClass += ' root';
                        }
                        
                        if (showNotation === 'intervals') {
                            displayText = intervalData.interval_name;
                            noteClass += ` interval-${intervalData.interval_name}`;
                        }
                    } else if (mode === 'scale') {
                        const scaleNotes = scaleData.notes || [];
                        
                        if (scaleNotes.includes(note)) {
                            showNote = true;
                            if (note === rootNote) {
                                noteClass += ' root';
                            } else {
                                noteClass += ' scale-note';
                            }
                            
                            if (showNotation === 'intervals') {
                                const interval = scaleData.intervals.find(i => i.note === note);
                                if (interval) {
                                    displayText = interval.interval_name;
                                    noteClass += ` interval-${interval.interval_name}`;
                                }
                            }
                        }
                    } else if (mode === 'chord') {
                        const chordNotes = chordData.notes || [];
                        
                        if (chordNotes.includes(note)) {
                            showNote = true;
                            if (note === rootNote) {
                                noteClass += ' root';
                            } else {
                                noteClass += ' chord-note';
                            }
                            
                            if (showNotation === 'intervals') {
                                const interval = chordData.intervals.find(i => i.note === note);
                                if (interval) {
                                    displayText = interval.interval_name;
                                    noteClass += ` interval-${interval.interval_name}`;
                                }
                            }
                        }
                    }
                    
                    if (showNote) {
                        const fretEl = document.querySelector(`.fret[data-string="${stringNum}"][data-fret="${fret}"]`);
                        
                        if (fretEl) {
                            const noteEl = document.createElement('div');
                            noteEl.className = noteClass;
                            noteEl.textContent = displayText;
                            fretEl.appendChild(noteEl);
                        }
                    }
                });
            });
        }
        
        // Renderiza intervalos
        function renderIntervals() {
            const rootNote = rootNoteEl.value;
            
            fretboardIntervalsData.forEach(string => {
                string.forEach(noteData => {
                    const { note, string: stringNum, fret, interval_name } = noteData;
                    
                    const fretEl = document.querySelector(`.fret[data-string="${stringNum}"][data-fret="${fret}"]`);
                    
                    if (fretEl) {
                        const noteEl = document.createElement('div');
                        
                        if (note === rootNote) {
                            noteEl.className = 'note root';
                        } else {
                            noteEl.className = `note interval-${interval_name}`;
                        }
                        
                        noteEl.textContent = showNotation === 'intervals' ? interval_name : note;
                        fretEl.appendChild(noteEl);
                    }
                });
            });
        }
        
        // Renderiza tríades da escala
        function renderScaleTriads() {
            renderNotes();
            
            const triadsListEl = document.getElementById('triads-list');
            triadsListEl.innerHTML = '';
            
            scaleTriads.forEach((triad, index) => {
                const triadEl = document.createElement('div');
                triadEl.className = 'legend-item';
                
                const degreeBadge = document.createElement('span');
                degreeBadge.className = `triad-badge triad-${getRomanNumeral(triad.degree).toLowerCase()}`;
                degreeBadge.textContent = getRomanNumeral(triad.degree);
                
                const triadInfoEl = document.createElement('div');
                triadInfoEl.className = 'triad-info';
                triadInfoEl.title = TRANSLATIONS[currentLanguage].showButton;
                
                let chordName = triad.root;
                switch(triad.type) {
                    case 'major': chordName += ''; break;
                    case 'minor': chordName += 'm'; break;
                    case 'dim': chordName += 'dim'; break;
                    case 'aug': chordName += 'aug'; break;
                    default: chordName += ' ' + triad.type; break;
                }
                
                const noteNames = showNotation === 'notes' ? 
                    triad.notes.join(', ') : 
                    triad.intervals.map(i => i.interval_name).join(', ');
                
                triadInfoEl.textContent = `${chordName} (${noteNames})`;
                
                // Fazer o elemento de informações clicável
                triadInfoEl.addEventListener('click', () => {
                    showTriadOnFretboard(triad, index);
                });
                
                triadEl.appendChild(degreeBadge);
                triadEl.appendChild(triadInfoEl);
                triadsListEl.appendChild(triadEl);
            });
        }
        
        // Renderiza todos os tipos de tríades
        function renderAllTriads() {
            const allTriadsListEl = document.getElementById('all-triads-list');
            allTriadsListEl.innerHTML = '';
            
            const rootNote = rootNoteEl.value;
            const triadTypes = ['major', 'minor', 'dim', 'aug'];
            
            triadTypes.forEach(type => {
                const triadEl = document.createElement('div');
                triadEl.className = 'legend-item';
                
                const typeBadge = document.createElement('span');
                typeBadge.className = `triad-badge triad-${type}`;
                typeBadge.textContent = TRANSLATIONS[currentLanguage].triadNames[type];
                
                const triadInfoEl = document.createElement('div');
                triadInfoEl.className = 'triad-info';
                triadInfoEl.title = TRANSLATIONS[currentLanguage].showButton;
                
                const triadData = allTriads[type];
                
                let chordName = rootNote;
                switch(type) {
                    case 'major': chordName += ''; break;
                    case 'minor': chordName += 'm'; break;
                    case 'dim': chordName += 'dim'; break;
                    case 'aug': chordName += 'aug'; break;
                    default: chordName += ' ' + type; break;
                }
                
                const noteNames = showNotation === 'notes' ? 
                    triadData.notes.join(', ') : 
                    triadData.intervals.map(i => i.interval_name).join(', ');
                
                triadInfoEl.textContent = `${chordName} (${noteNames})`;
                
                // Fazer o elemento de informações clicável
                triadInfoEl.addEventListener('click', () => {
                    showAllTriadType(type);
                });
                
                triadEl.appendChild(typeBadge);
                triadEl.appendChild(triadInfoEl);
                allTriadsListEl.appendChild(triadEl);
            });
            
            showAllTriadType('major');
        }
        
        // Exibe uma tríade da escala no braço
        function showTriadOnFretboard(triad, triadIndex) {
            document.querySelectorAll('.note').forEach(el => el.remove());
            
            currentTriadIndex = triadIndex;
            
            fretboardData.forEach(string => {
                string.forEach(noteData => {
                    const { note, string: stringNum, fret } = noteData;
                    
                    if (triad.notes.includes(note)) {
                        const fretEl = document.querySelector(`.fret[data-string="${stringNum}"][data-fret="${fret}"]`);
                        
                        if (fretEl) {
                            const noteEl = document.createElement('div');
                            let displayText = note;
                            
                            if (note === triad.root) {
                                noteEl.className = `note triad-note`;
                            } else {
                                noteEl.className = `note chord-note`;
                            }
                            
                            if (showNotation === 'intervals') {
                                const interval = triad.intervals.find(i => i.note === note);
                                if (interval) {
                                    displayText = interval.interval_name;
                                    noteEl.className += ` interval-${interval.interval_name}`;
                                }
                            }
                            
                            noteEl.textContent = displayText;
                            fretEl.appendChild(noteEl);
                        }
                    }
                });
            });
        }
        
        // Exibe um tipo de tríade no braço
        function showAllTriadType(triadType) {
            document.querySelectorAll('.note').forEach(el => el.remove());
            
            currentTriadType = triadType;
            const triadData = allTriads[triadType];
            const rootNote = rootNoteEl.value;
            
            fretboardData.forEach(string => {
                string.forEach(noteData => {
                    const { note, string: stringNum, fret } = noteData;
                    
                    if (triadData.notes.includes(note)) {
                        const fretEl = document.querySelector(`.fret[data-string="${stringNum}"][data-fret="${fret}"]`);
                        
                        if (fretEl) {
                            const noteEl = document.createElement('div');
                            let displayText = note;
                            
                            if (note === rootNote) {
                                noteEl.className = `note triad-note`;
                            } else {
                                noteEl.className = `note triad-${triadType}`;
                            }
                            
                            if (showNotation === 'intervals') {
                                const interval = triadData.intervals.find(i => i.note === note);
                                if (interval) {
                                    displayText = interval.interval_name;
                                    noteEl.className += ` interval-${interval.interval_name}`;
                                }
                            }
                            
                            noteEl.textContent = displayText;
                            fretEl.appendChild(noteEl);
                        }
                    }
                });
            });
        }
        
        // Função para converter número para numeral romano
        function getRomanNumeral(num) {
            const romanNumerals = ['I', 'II', 'III', 'IV', 'V', 'VI', 'VII'];
            return romanNumerals[num - 1] || num.toString();
        }
        
        // Inicializa a aplicação
        init();
    </script>
</body>
</html>
